[
  {
    "slug": "hashlabs",
    "title": "How Stratum V2 Increases Mining Profitability",
    "description": "We are thrilled to announce the launch of SRI 1.0.0! This marks an important milestone in our mission to decentralize and enhance bitcoin mining and stands ready for immediate testing and integration.",
    "date": "2025-06-12",
    "formattedDate": "Jun 12, 2025",
    "authors": [
      "Pavlenex"
    ],
    "tags": [
      "Case-study",
      "Research"
    ],
    "content": "**This case study compares two Bitcoin mining protocols, Stratum V1 and V2 , and demonstrates how the combined technical improvements of Stratum V2 translate into a substantial profitability increase for miners.**\r\n\r\n![](/assets/case-study/hashlabs/featured.jpeg)\r\n\r\nIn bitcoin mining, a millisecond can determine whether a miner successfully earns the block reward or loses out to a competitor. At the core of this race lies the **mining protocol** that connects miners, pools, and the network, with the goal of ensuring effective communication between participants.\r\n\r\nFor over a decade, **Stratum V1 (SV1)** has served as the industry standard mining protocol, but as mining competition has intensified over the years, the need for technical improvements on the protocol-side has become apparent. While we have seen massive technical improvements on the mining hardware side over the past decade, miners have been stuck with a less than optimal protocol.\r\n\r\nThis is why we have developed **Stratum V2 (SV2)**, the successor to SV1. This protocol is associated with **miner-side block construction**, allowing miners to run their own nodes and create their own block templates. While this remains a critical innovation, SV2 also introduces substantial improvements in **security and efficiency** impacting profitability.\r\n\r\n## **Objectives & Methodology**\r\n\r\nThe primary objective of the case study is to evaluate if SV2 improves mining efficiency and profitability compared to SV1. This is achieved by measuring the following **key performance indicators** and evaluating their impact on net profitability:\r\n\r\n* Share Submission  \r\n* Latency: \r\n  * Block Change  \r\n  * Job Latency  \r\n  * Block Propagation  \r\n* Hashrate Hijacking\r\n\r\nThis study was conducted at [Hashlabs](https://www.hashlabs.io) using two identical S19k Pro ASIC miners, one running SV1 and the other SV2. Tests were performed in a controlled environment with simulated network latency, containerized infrastructure, and an early-stage open-source [benchmarking tool](https://github.com/stratum-mining/benchmarking-tool). For a detailed breakdown of the testing process, refer to Appendix A: Benchmarking Setup and Methodology.\r\n\r\n### **Share Acceptance Rate**\r\n\r\n**Share Acceptance** **Rate** refers to the percentage of valid work a miner submits to the pool in the form of shares. Shares can be either valid or stale. \r\n\r\n* **Valid shares** are based on the current chain tip and result in a payout.   \r\n* **Stale shares** are submitted too late, often due to network latency or inefficient communication, and are rejected. This represents wasted hashing power.\r\n\r\nHowever, not all stale shares are caused by inefficiencies. On average, about 2% of stale shares are rejected for expected reasons, such as not meeting the pool’s minimum difficulty. This 2% rejection rate is considered an industry standard. The remaining 98% are preventable and caused by avoidable delays. Reducing these avoidable stale shares improves mining efficiency and increases profitability.\r\n\r\n![](/assets/case-study/hashlabs/share-acceptance.png)\r\n\r\nOur benchmark data shows that miners using **Stratum V1** waste between **0.1% and 0.2%** of their hashing power submitting shares that do not result in payouts. Switching to **Stratum V2 without Job Declaration** reduces this inefficiency to around 0.08%, while using **Stratum V2 with Job Declaration** eliminates it nearly entirely, assuming miner and pool node have the same level of connectivity.\r\n\r\nFor miners operating on thin profit margins of around **10%**, this translates to a potential **net profit increase of up to 2% when fully adopting Stratum V2 with Job Declaration**.\r\n\r\nBy connecting directly to a local **Job Declaration Client ([JDC](https://stratumprotocol.org/specification/06-Job-Declaration-Protocol/#62-job-declarator-client))**, which is connected to the **Bitcoin node running on-site by the miner**, SV2 ensures miners continuously receive the most up-to-date jobs. This setup minimizes latency and maximizes the freshness of jobs.\r\n\r\nOur tests used only a single SV1 connected to the tProxy. We anticipate that Stratum V2's advantage would increase further with multiple downstream connections. In fact, a separate test conducted using CPU miners demonstrated an additional **0.4% improvement** in favor of Stratum V2, as shown in the chart below.\r\n\r\n![](/assets/case-study/hashlabs/share-acceptance-2.png)\r\n\r\n### **Latency**\r\n\r\nOur benchmarks demonstrate **substantial latency improvements** using Stratum V2 compared to Stratum V1. These improvements are again attributed to the Job Declaration Client (JDC). The JDC, connected to the Bitcoin node positioned within the mining farm’s local network, drastically reduces latency by delivering fresh mining jobs directly to ASICs. In comparison, Stratum V1 relies on remote pools to distribute jobs, introducing higher latency due to network distance and potential congestion.\r\n\r\nTo further contextualize these results, we measured the network latency to various production pool endpoints during the benchmark sessions. The average round-trip time (RTT) observed across four reports was approximately 110ms. This value was used internally within the tool infrastructure to simulate realistic network conditions during the benchmarks.\r\n\r\n![](/assets/case-study/hashlabs/latency-all.png)\r\n\r\n#### **Block Change latency**\r\n\r\n**Block Change Latency** is a delay experienced when **switching to a new job after a block is found on the network**. During this brief period, miners continue working on outdated job templates that will not be rewarded, resulting in entirely wasted hash power. Reducing this latency directly improves profitability.\r\n\r\n![](/assets/case-study/hashlabs/block-change-latency.png)\r\n\r\nAccording to our benchmarking data, **Stratum V2 with Job Declaration (JD)** reduces block change latency from **325 ms (SV1)** to just **1.42 ms**, a difference of **323.58 ms**, making it over **228 times faster**. Even without JD, **SV2 still improves latency**, reducing it to **57.8 ms**, about **5.6 times faster** than SV1.\r\n\r\nSV1 miners lose approximately **323.58 milliseconds per block** due to block change latency compared to SV2 with JD. Over a year, this adds up to around **4.9 hours** of completely wasted hashing time. To quantify the efficiency gain of switching to SV2 with JD, we compare this latency difference to the total block interval of **600,000 milliseconds** (10 minutes):\r\n\r\n![](/assets/case-study/hashlabs/efficiency-gain.png)\r\n\r\nFor miners operating on a **10% profit margin**, this translates to a **net profit increase of approximately 0.54%** by switching from SV1 to **SV2 with Job Declaration**. Since block change latency directly causes shares to become stale and rejected, its impact is already captured in our share acceptance rate.\r\n\r\n#### **Job Latency**\r\n\r\n**Job Latency** refers to the time it takes for miners to receive new jobs from the Pool (or from the JDC, in the case of SV2), which typically occurs every 30 seconds, but may also occur more frequently. While this latency does not result in wasted hash power, it introduces an **opportunity cost**. \r\n\r\nDuring the delay, miners may continue working on valid job templates that do not include the most recent transactions, potentially reducing the fee revenue earned per block.\r\n\r\n![](/assets/case-study/hashlabs/job-latency.png)\r\n\r\nAccording to our benchmarking data, **Stratum V2 with Job Declaration (JD)** reduces job latency from **228 ms (SV1)** to just **2.44 ms**, a difference of **225.54 ms**, making it over **93 times faster**. Even without JD, **SV2 still improves latency**, reducing it to **57.8 ms**, about **4 times faster** than SV1.\r\n\r\nTo quantify this, a time-based fee growth model was applied to a dataset of 53,154 Bitcoin blocks spanning approximately one year. The assumption is that transaction fees accumulate linearly across the 600-second block interval, and that job templates are refreshed 20 times per block (every 30 seconds). Given the latency difference between SV1 (0.228 seconds) and SV2 with JD (0.00244 seconds), and a fee growth rate of **0.00031443 BTC per second**, the cumulative fee loss per block is modeled as:\r\n\r\n![](/assets/case-study/hashlabs/block-loss.png)\r\n\r\nThe average transaction fee per block, based on a total of 10,027.81 BTC in fees across the dataset of 53,154 blocks, is **0.18866 BTC**. The opportunity cost per block for SV1 miners is:\r\n\r\n![](/assets/case-study/hashlabs/oportunity-cost.png)\r\n\r\n**This means SV1 miners lose approximately 0.75% of potential transaction fee revenue on every block** simply due to job latency. Over thousands of blocks, this adds up to a significant long-term loss.\r\n\r\nWhile this 0.75% figure reflects the percentage of fee revenue lost per block, it does not represent a gain relative to the entire block reward. When accounting for both the transaction fees (0.18866 BTC) and the block subsidy (3.125 BTC), the total block reward is approximately 3.31366 BTC. The 0.00141 BTC gain from reduced job latency therefore corresponds to a 0.04% increase in total block revenue. For miners operating on a 10% profit margin, this translates into a **0.4% net profit boost**. \r\n\r\nEven when comparing SV2 without JD to SV2 with JD, the latency difference of 55.3 milliseconds results in a cumulative block loss of **0.000347 BTC**, translating into an opportunity cost of approximately **0.18%** per block. \r\n\r\nIn both cases, reducing job latency increases profitability by ensuring miners are working on the most up-to-date block templates with the highest fee density.\r\n\r\n![](/assets/case-study/hashlabs/job-latency-table.png)\r\n\r\n**Switching to SV2 with Job Declaration potentially unlocks up to 74 BTC in additional transaction fee revenue per year** across the entire Bitcoin network, simply by reducing job latency.\r\n\r\nThis figure comes from multiplying the average opportunity cost per block (0.00141 BTC) by the number of blocks mined annually (52,560), which gives:\r\n\r\n![](/assets/case-study/hashlabs/job-latency-2.png)\r\n\r\nAt a BTC price of $110,000, this translates to more than **8.17 million USD in extra revenue** that miners could collectively capture by switching to SV2 with JD. \r\n\r\nAs transaction fees are expected to become a larger portion of miner income over time, **reducing fee-related inefficiencies** will become increasingly **critical** **for long-term profitability**. \r\n\r\n### **Block Propagation**\r\n\r\n**Block Propagation Latency** measures the time it takes for a newly mined block to be broadcasted and accepted by the Bitcoin network. Faster propagation improves profitability by increasing the [likelihood](https://bitcoin.stackexchange.com/questions/126019/up-to-date-statistics-about-chain-reorganizations) that a miner’s block is accepted first, especially during chain-split races. \r\n\r\n![](/assets/case-study/hashlabs/block-propagation.png)\r\n\r\nSV2 with Job Declaration reduces block propagation time from **96.3 milliseconds (SV1)** to just **3.44 milliseconds**, making block propagation faster. The major improvement in block propagation speed with Stratum V2 results primarily from its architectural design. Stratum V2 enables **dual block propagation**. A block can be propagated from the miner-side Job Declaration Client (JDC) in addition to the server-side Job Declaration Server (JDS), hosted by the mining pool. Conversely, Stratum V1 only propagates blocks from the pool-side server, leading to higher propagation delays.\r\n\r\nThe impact of improved block propagation speed can be significant, particularly during tight race conditions such as chain splits, where delays in propagating a mined block may result in a complete loss of the block reward, potentially causing substantial revenue losses. However, accurately predicting the occurrence and frequency of these events is practically challenging. Chain splits occur unpredictably and infrequently, making it difficult to precisely quantify the long-term profitability gains from reduced propagation latency. Nonetheless, given the competitive nature of mining, even infrequent events can meaningfully influence profitability over extended periods.\r\n\r\n## **Hashrate Hijacking**\r\n\r\nStratum V1 exposes miners to a critical vulnerability: hashrate hijacking. Due to its lack of encryption and authentication, an attacker positioned between a miner and its pool can intercept job data and submit the miner’s resulting shares under their own credentials. The miner continues working, unaware that they are no longer receiving credit for their hashpower. Based on industry estimates, this type of attack happens often, resulting in [1%-2% of hashrate](https://braiins.com/blog/hashrate-robbery-stratum-v2-fixes-this-and-more) being effectively stolen, to avoid detection.\r\n\r\nStratum V2 addresses this risk by encrypting the communication channel and enforcing authentication, making hashrate hijacking practically impossible. For miners operating on 10% profit margins, recovering even a 0.5% loss in effective hashrate can **boost net profit by up to 5%**.\r\n\r\n## **Summary**\r\n\r\nBy reducing latency, optimizing share submissions, and improving security, **Stratum V2** achieves a potential gain in net profit of **7.75%** coming exclusively from technical advancements.\r\n\r\nAdditional profitability gains from transparency improvements, such as preventing pools from secretly withholding hashrate or obscuring true fees, are outside the scope of this research but merit further investigation.\r\n\r\n| KPI / Improvement                   | Type                             | Net Profit Gain       |\r\n| ----------------------------------- | -------------------------------- | --------------------- |\r\n| **Reduced stale shares**            | Measured efficiency gain         | **+2.0%**             |\r\n| **Fee gain from lower job latency** | Modeled, margin-adjusted gain    | **+0.4%**             |\r\n| **Hashrate hijacking protection**   | Industry-estimated security gain | **+5.0%**             |\r\n| **Block change latency**            | Included in stale share impact   | *(not counted twice)* |\r\n| **Block propagation**               | Latency improvement, not modeled | *(unmeasured)*        |\r\n| **Total estimated net profit gain** |                                  | **up to 7.4%**        |\r\n\r\nBeyond efficiency and profitability, Stratum V2 strengthens **security** through end-to-end encryption, **eliminating hashrate hijacking**, and empowering miners to **construct their own block templates** helping preserve Bitcoin’s core principles of security, decentralization and censorship resistance.\r\n\r\nIn addition to these measurable gains Stratum V2 introduces greater modularity and flexibility to mining operations. Unlike SV1’s rigid, pool-centric architecture, SV2 allows for more advanced network and daemon setups, enabling redundancy and failover strategies that weren’t previously possible. With features like Job Declaration (JD), miners can automatically fall back to solo mining if a pool connection drops, keeping operations running even over limited bandwidth connections (such as LTE). This reduces the risk of a single point of failure and gives operators more control over uptime.\r\n\r\n**Our benchmarking demonstrates that in the relentless pursuit of excellence within Bitcoin mining, Stratum V2 provides a competitive edge through measurable profitability improvements.**\r\n\r\nAdopting Stratum V2 is not merely about incremental improvements; nor is it only about decentralization. It's about securing a decisive edge in an increasingly competitive environment where fractional optimizations can impact profitability and can be the difference between success and failure.\r\n\r\nThe results presented in this report should be seen as directional, highlighting the potential of SV2 rather than representing its full capabilities. As the [benchmarking tool](https://github.com/stratum-mining/benchmarking-tool) and SV2 applications [mature](https://github.com/stratum-mining/stratum?tab=readme-ov-file#-project-maturity), we expect to see even more compelling performance improvements.\r\n\r\n---\r\n\r\nAcknowledgements:\r\n\r\nThis case study is the result of a collaborative effort from the mining community. We’re grateful to everyone who contributed their time, feedback, and expertise throughout the benchmarking process. Special thanks to those who reviewed early drafts, tested the benchmarking tool, and helped refine the methodology:\r\n\r\nAlejandro De La Torre, Alen Mahmetov, Filippo Merli, Francisco Quadrio Monteiro, Gabriele Vernetti, Gary Krause, General Kenobi, Jakub Trnka, Jaran Mellerud, Jay Beddict, Lorenzo Bonazzi, Matt Corallo, Martin Schneider, Pavlenex, Plebhash, Reese Russel, Sjors Provoost, Steve Lee.\r\n\r\n## Appendix A: Benchmarking Setup and Methodology\r\n\r\n**This appendix outlines the complete setup, configurations, tools, and assumptions used in the SV2 vs SV1 benchmarking process.**\r\n\r\nThe benchmarking was conducted at Hashlabs facilities using two identical hardware devices **ASIC S19k Pro 120Th**, running stock firmware (MD5:a859d95a7110b29b0b70e3e681a5aa2c 2024-04-12) each configured to run separately on SV1 and SV2. The tests were performed under controlled conditions on the Bitcoin mainnet network and Testnet 4 (for measuring block propagation speed) using an [open-source benchmarking tool.](https://github.com/stratum-mining/benchmarking-tool) It is important to note that the **benchmarking tool** is in its alpha stage, and there is room for improvement for both SV1 and SV2 stacks.\r\n\r\nAll tests were executed via a **dedicated VPS**, which launched the entire benchmarking environment, including pool servers, proxies, and nodes, within **Docker containers**, ensuring all components shared the same hardware resources (CPU, memory, storage). \r\n\r\nTo simulate real-world latency conditions, **artificial network delays** were introduced by the [benchmarking-tool](https://github.com/stratum-mining/benchmarking-tool). These delays are dynamically adjusted based on a continuously updated measurement of the **average latency between the benchmarking environment and major mining pools** such as Antpool, Braiins Pool, F2Pool, SpiderPool, Ocean, and ViaBTC. The latency calculation logic is available [here](https://github.com/stratum-mining/benchmarking-tool/tree/main/pools-latency-calculator).\r\n\r\nThe SV1 pool was implemented using the open-source [public-pool software](https://github.com/benjamin-wilson/public-pool), while SV2 leveraged the complete suite of applications (Pool, Proxy, JDC, JDS) developed and maintained by [SRI](https://github.com/stratum-mining/stratum/tree/main/roles). The SV2 applications deployed are reference implementations and are not considered production ready. However, the protocol layer of the reference implementation is solid, and developers are encouraged to build production-grade applications on top of it. \r\n\r\nEach SV1 and SV2 pool instance operated with **its own dedicated Bitcoin node**, ensuring isolation and proper protocol-specific behavior. In the **SV2 Configuration with Job Declaration**, the miner also ran **a local Bitcoin node** to enable block template construction.\r\n\r\nWe evaluated usage across two SV2 configurations and compared them to SV1:\r\n\r\n1. **Without Job Declaration (JD):** Uses a Translation Proxy (tProxy) to enable SV1 firmware miners to connect to an SV2 pool without requiring a full node.  \r\n2. **With Job Declaration (JD):** Deploys the complete SV2 stack (including a local Bitcoin node on the miner side). It grants miners control over block template construction but increases miner-side bandwidth, due to running a local Bitcoin node.\r\n",
    "html": "<p><strong>This case study compares two Bitcoin mining protocols, Stratum V1 and V2 , and demonstrates how the combined technical improvements of Stratum V2 translate into a substantial profitability increase for miners.</strong></p>\n<p><img src=\"/assets/case-study/hashlabs/featured.jpeg\" alt=\"\"></p>\n<p>In bitcoin mining, a millisecond can determine whether a miner successfully earns the block reward or loses out to a competitor. At the core of this race lies the <strong>mining protocol</strong> that connects miners, pools, and the network, with the goal of ensuring effective communication between participants.</p>\n<p>For over a decade, <strong>Stratum V1 (SV1)</strong> has served as the industry standard mining protocol, but as mining competition has intensified over the years, the need for technical improvements on the protocol-side has become apparent. While we have seen massive technical improvements on the mining hardware side over the past decade, miners have been stuck with a less than optimal protocol.</p>\n<p>This is why we have developed <strong>Stratum V2 (SV2)</strong>, the successor to SV1. This protocol is associated with <strong>miner-side block construction</strong>, allowing miners to run their own nodes and create their own block templates. While this remains a critical innovation, SV2 also introduces substantial improvements in <strong>security and efficiency</strong> impacting profitability.</p>\n<h2><strong>Objectives &amp; Methodology</strong></h2>\n<p>The primary objective of the case study is to evaluate if SV2 improves mining efficiency and profitability compared to SV1. This is achieved by measuring the following <strong>key performance indicators</strong> and evaluating their impact on net profitability:</p>\n<ul>\n<li>Share Submission</li>\n<li>Latency:\n<ul>\n<li>Block Change</li>\n<li>Job Latency</li>\n<li>Block Propagation</li>\n</ul>\n</li>\n<li>Hashrate Hijacking</li>\n</ul>\n<p>This study was conducted at <a href=\"https://www.hashlabs.io\">Hashlabs</a> using two identical S19k Pro ASIC miners, one running SV1 and the other SV2. Tests were performed in a controlled environment with simulated network latency, containerized infrastructure, and an early-stage open-source <a href=\"https://github.com/stratum-mining/benchmarking-tool\">benchmarking tool</a>. For a detailed breakdown of the testing process, refer to Appendix A: Benchmarking Setup and Methodology.</p>\n<h3><strong>Share Acceptance Rate</strong></h3>\n<p><strong>Share Acceptance</strong> <strong>Rate</strong> refers to the percentage of valid work a miner submits to the pool in the form of shares. Shares can be either valid or stale.</p>\n<ul>\n<li><strong>Valid shares</strong> are based on the current chain tip and result in a payout.</li>\n<li><strong>Stale shares</strong> are submitted too late, often due to network latency or inefficient communication, and are rejected. This represents wasted hashing power.</li>\n</ul>\n<p>However, not all stale shares are caused by inefficiencies. On average, about 2% of stale shares are rejected for expected reasons, such as not meeting the pool’s minimum difficulty. This 2% rejection rate is considered an industry standard. The remaining 98% are preventable and caused by avoidable delays. Reducing these avoidable stale shares improves mining efficiency and increases profitability.</p>\n<p><img src=\"/assets/case-study/hashlabs/share-acceptance.png\" alt=\"\"></p>\n<p>Our benchmark data shows that miners using <strong>Stratum V1</strong> waste between <strong>0.1% and 0.2%</strong> of their hashing power submitting shares that do not result in payouts. Switching to <strong>Stratum V2 without Job Declaration</strong> reduces this inefficiency to around 0.08%, while using <strong>Stratum V2 with Job Declaration</strong> eliminates it nearly entirely, assuming miner and pool node have the same level of connectivity.</p>\n<p>For miners operating on thin profit margins of around <strong>10%</strong>, this translates to a potential <strong>net profit increase of up to 2% when fully adopting Stratum V2 with Job Declaration</strong>.</p>\n<p>By connecting directly to a local <strong>Job Declaration Client (<a href=\"https://stratumprotocol.org/specification/06-Job-Declaration-Protocol/#62-job-declarator-client\">JDC</a>)</strong>, which is connected to the <strong>Bitcoin node running on-site by the miner</strong>, SV2 ensures miners continuously receive the most up-to-date jobs. This setup minimizes latency and maximizes the freshness of jobs.</p>\n<p>Our tests used only a single SV1 connected to the tProxy. We anticipate that Stratum V2’s advantage would increase further with multiple downstream connections. In fact, a separate test conducted using CPU miners demonstrated an additional <strong>0.4% improvement</strong> in favor of Stratum V2, as shown in the chart below.</p>\n<p><img src=\"/assets/case-study/hashlabs/share-acceptance-2.png\" alt=\"\"></p>\n<h3><strong>Latency</strong></h3>\n<p>Our benchmarks demonstrate <strong>substantial latency improvements</strong> using Stratum V2 compared to Stratum V1. These improvements are again attributed to the Job Declaration Client (JDC). The JDC, connected to the Bitcoin node positioned within the mining farm’s local network, drastically reduces latency by delivering fresh mining jobs directly to ASICs. In comparison, Stratum V1 relies on remote pools to distribute jobs, introducing higher latency due to network distance and potential congestion.</p>\n<p>To further contextualize these results, we measured the network latency to various production pool endpoints during the benchmark sessions. The average round-trip time (RTT) observed across four reports was approximately 110ms. This value was used internally within the tool infrastructure to simulate realistic network conditions during the benchmarks.</p>\n<p><img src=\"/assets/case-study/hashlabs/latency-all.png\" alt=\"\"></p>\n<h4><strong>Block Change latency</strong></h4>\n<p><strong>Block Change Latency</strong> is a delay experienced when <strong>switching to a new job after a block is found on the network</strong>. During this brief period, miners continue working on outdated job templates that will not be rewarded, resulting in entirely wasted hash power. Reducing this latency directly improves profitability.</p>\n<p><img src=\"/assets/case-study/hashlabs/block-change-latency.png\" alt=\"\"></p>\n<p>According to our benchmarking data, <strong>Stratum V2 with Job Declaration (JD)</strong> reduces block change latency from <strong>325 ms (SV1)</strong> to just <strong>1.42 ms</strong>, a difference of <strong>323.58 ms</strong>, making it over <strong>228 times faster</strong>. Even without JD, <strong>SV2 still improves latency</strong>, reducing it to <strong>57.8 ms</strong>, about <strong>5.6 times faster</strong> than SV1.</p>\n<p>SV1 miners lose approximately <strong>323.58 milliseconds per block</strong> due to block change latency compared to SV2 with JD. Over a year, this adds up to around <strong>4.9 hours</strong> of completely wasted hashing time. To quantify the efficiency gain of switching to SV2 with JD, we compare this latency difference to the total block interval of <strong>600,000 milliseconds</strong> (10 minutes):</p>\n<p><img src=\"/assets/case-study/hashlabs/efficiency-gain.png\" alt=\"\"></p>\n<p>For miners operating on a <strong>10% profit margin</strong>, this translates to a <strong>net profit increase of approximately 0.54%</strong> by switching from SV1 to <strong>SV2 with Job Declaration</strong>. Since block change latency directly causes shares to become stale and rejected, its impact is already captured in our share acceptance rate.</p>\n<h4><strong>Job Latency</strong></h4>\n<p><strong>Job Latency</strong> refers to the time it takes for miners to receive new jobs from the Pool (or from the JDC, in the case of SV2), which typically occurs every 30 seconds, but may also occur more frequently. While this latency does not result in wasted hash power, it introduces an <strong>opportunity cost</strong>.</p>\n<p>During the delay, miners may continue working on valid job templates that do not include the most recent transactions, potentially reducing the fee revenue earned per block.</p>\n<p><img src=\"/assets/case-study/hashlabs/job-latency.png\" alt=\"\"></p>\n<p>According to our benchmarking data, <strong>Stratum V2 with Job Declaration (JD)</strong> reduces job latency from <strong>228 ms (SV1)</strong> to just <strong>2.44 ms</strong>, a difference of <strong>225.54 ms</strong>, making it over <strong>93 times faster</strong>. Even without JD, <strong>SV2 still improves latency</strong>, reducing it to <strong>57.8 ms</strong>, about <strong>4 times faster</strong> than SV1.</p>\n<p>To quantify this, a time-based fee growth model was applied to a dataset of 53,154 Bitcoin blocks spanning approximately one year. The assumption is that transaction fees accumulate linearly across the 600-second block interval, and that job templates are refreshed 20 times per block (every 30 seconds). Given the latency difference between SV1 (0.228 seconds) and SV2 with JD (0.00244 seconds), and a fee growth rate of <strong>0.00031443 BTC per second</strong>, the cumulative fee loss per block is modeled as:</p>\n<p><img src=\"/assets/case-study/hashlabs/block-loss.png\" alt=\"\"></p>\n<p>The average transaction fee per block, based on a total of 10,027.81 BTC in fees across the dataset of 53,154 blocks, is <strong>0.18866 BTC</strong>. The opportunity cost per block for SV1 miners is:</p>\n<p><img src=\"/assets/case-study/hashlabs/oportunity-cost.png\" alt=\"\"></p>\n<p><strong>This means SV1 miners lose approximately 0.75% of potential transaction fee revenue on every block</strong> simply due to job latency. Over thousands of blocks, this adds up to a significant long-term loss.</p>\n<p>While this 0.75% figure reflects the percentage of fee revenue lost per block, it does not represent a gain relative to the entire block reward. When accounting for both the transaction fees (0.18866 BTC) and the block subsidy (3.125 BTC), the total block reward is approximately 3.31366 BTC. The 0.00141 BTC gain from reduced job latency therefore corresponds to a 0.04% increase in total block revenue. For miners operating on a 10% profit margin, this translates into a <strong>0.4% net profit boost</strong>.</p>\n<p>Even when comparing SV2 without JD to SV2 with JD, the latency difference of 55.3 milliseconds results in a cumulative block loss of <strong>0.000347 BTC</strong>, translating into an opportunity cost of approximately <strong>0.18%</strong> per block.</p>\n<p>In both cases, reducing job latency increases profitability by ensuring miners are working on the most up-to-date block templates with the highest fee density.</p>\n<p><img src=\"/assets/case-study/hashlabs/job-latency-table.png\" alt=\"\"></p>\n<p><strong>Switching to SV2 with Job Declaration potentially unlocks up to 74 BTC in additional transaction fee revenue per year</strong> across the entire Bitcoin network, simply by reducing job latency.</p>\n<p>This figure comes from multiplying the average opportunity cost per block (0.00141 BTC) by the number of blocks mined annually (52,560), which gives:</p>\n<p><img src=\"/assets/case-study/hashlabs/job-latency-2.png\" alt=\"\"></p>\n<p>At a BTC price of $110,000, this translates to more than <strong>8.17 million USD in extra revenue</strong> that miners could collectively capture by switching to SV2 with JD.</p>\n<p>As transaction fees are expected to become a larger portion of miner income over time, <strong>reducing fee-related inefficiencies</strong> will become increasingly <strong>critical</strong> <strong>for long-term profitability</strong>.</p>\n<h3><strong>Block Propagation</strong></h3>\n<p><strong>Block Propagation Latency</strong> measures the time it takes for a newly mined block to be broadcasted and accepted by the Bitcoin network. Faster propagation improves profitability by increasing the <a href=\"https://bitcoin.stackexchange.com/questions/126019/up-to-date-statistics-about-chain-reorganizations\">likelihood</a> that a miner’s block is accepted first, especially during chain-split races.</p>\n<p><img src=\"/assets/case-study/hashlabs/block-propagation.png\" alt=\"\"></p>\n<p>SV2 with Job Declaration reduces block propagation time from <strong>96.3 milliseconds (SV1)</strong> to just <strong>3.44 milliseconds</strong>, making block propagation faster. The major improvement in block propagation speed with Stratum V2 results primarily from its architectural design. Stratum V2 enables <strong>dual block propagation</strong>. A block can be propagated from the miner-side Job Declaration Client (JDC) in addition to the server-side Job Declaration Server (JDS), hosted by the mining pool. Conversely, Stratum V1 only propagates blocks from the pool-side server, leading to higher propagation delays.</p>\n<p>The impact of improved block propagation speed can be significant, particularly during tight race conditions such as chain splits, where delays in propagating a mined block may result in a complete loss of the block reward, potentially causing substantial revenue losses. However, accurately predicting the occurrence and frequency of these events is practically challenging. Chain splits occur unpredictably and infrequently, making it difficult to precisely quantify the long-term profitability gains from reduced propagation latency. Nonetheless, given the competitive nature of mining, even infrequent events can meaningfully influence profitability over extended periods.</p>\n<h2><strong>Hashrate Hijacking</strong></h2>\n<p>Stratum V1 exposes miners to a critical vulnerability: hashrate hijacking. Due to its lack of encryption and authentication, an attacker positioned between a miner and its pool can intercept job data and submit the miner’s resulting shares under their own credentials. The miner continues working, unaware that they are no longer receiving credit for their hashpower. Based on industry estimates, this type of attack happens often, resulting in <a href=\"https://braiins.com/blog/hashrate-robbery-stratum-v2-fixes-this-and-more\">1%-2% of hashrate</a> being effectively stolen, to avoid detection.</p>\n<p>Stratum V2 addresses this risk by encrypting the communication channel and enforcing authentication, making hashrate hijacking practically impossible. For miners operating on 10% profit margins, recovering even a 0.5% loss in effective hashrate can <strong>boost net profit by up to 5%</strong>.</p>\n<h2><strong>Summary</strong></h2>\n<p>By reducing latency, optimizing share submissions, and improving security, <strong>Stratum V2</strong> achieves a potential gain in net profit of <strong>7.75%</strong> coming exclusively from technical advancements.</p>\n<p>Additional profitability gains from transparency improvements, such as preventing pools from secretly withholding hashrate or obscuring true fees, are outside the scope of this research but merit further investigation.</p>\n<table>\n<thead>\n<tr>\n<th>KPI / Improvement</th>\n<th>Type</th>\n<th>Net Profit Gain</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Reduced stale shares</strong></td>\n<td>Measured efficiency gain</td>\n<td><strong>+2.0%</strong></td>\n</tr>\n<tr>\n<td><strong>Fee gain from lower job latency</strong></td>\n<td>Modeled, margin-adjusted gain</td>\n<td><strong>+0.4%</strong></td>\n</tr>\n<tr>\n<td><strong>Hashrate hijacking protection</strong></td>\n<td>Industry-estimated security gain</td>\n<td><strong>+5.0%</strong></td>\n</tr>\n<tr>\n<td><strong>Block change latency</strong></td>\n<td>Included in stale share impact</td>\n<td><em>(not counted twice)</em></td>\n</tr>\n<tr>\n<td><strong>Block propagation</strong></td>\n<td>Latency improvement, not modeled</td>\n<td><em>(unmeasured)</em></td>\n</tr>\n<tr>\n<td><strong>Total estimated net profit gain</strong></td>\n<td></td>\n<td><strong>up to 7.4%</strong></td>\n</tr>\n</tbody>\n</table>\n<p>Beyond efficiency and profitability, Stratum V2 strengthens <strong>security</strong> through end-to-end encryption, <strong>eliminating hashrate hijacking</strong>, and empowering miners to <strong>construct their own block templates</strong> helping preserve Bitcoin’s core principles of security, decentralization and censorship resistance.</p>\n<p>In addition to these measurable gains Stratum V2 introduces greater modularity and flexibility to mining operations. Unlike SV1’s rigid, pool-centric architecture, SV2 allows for more advanced network and daemon setups, enabling redundancy and failover strategies that weren’t previously possible. With features like Job Declaration (JD), miners can automatically fall back to solo mining if a pool connection drops, keeping operations running even over limited bandwidth connections (such as LTE). This reduces the risk of a single point of failure and gives operators more control over uptime.</p>\n<p><strong>Our benchmarking demonstrates that in the relentless pursuit of excellence within Bitcoin mining, Stratum V2 provides a competitive edge through measurable profitability improvements.</strong></p>\n<p>Adopting Stratum V2 is not merely about incremental improvements; nor is it only about decentralization. It’s about securing a decisive edge in an increasingly competitive environment where fractional optimizations can impact profitability and can be the difference between success and failure.</p>\n<p>The results presented in this report should be seen as directional, highlighting the potential of SV2 rather than representing its full capabilities. As the <a href=\"https://github.com/stratum-mining/benchmarking-tool\">benchmarking tool</a> and SV2 applications <a href=\"https://github.com/stratum-mining/stratum?tab=readme-ov-file#-project-maturity\">mature</a>, we expect to see even more compelling performance improvements.</p>\n<hr>\n<p>Acknowledgements:</p>\n<p>This case study is the result of a collaborative effort from the mining community. We’re grateful to everyone who contributed their time, feedback, and expertise throughout the benchmarking process. Special thanks to those who reviewed early drafts, tested the benchmarking tool, and helped refine the methodology:</p>\n<p>Alejandro De La Torre, Alen Mahmetov, Filippo Merli, Francisco Quadrio Monteiro, Gabriele Vernetti, Gary Krause, General Kenobi, Jakub Trnka, Jaran Mellerud, Jay Beddict, Lorenzo Bonazzi, Matt Corallo, Martin Schneider, Pavlenex, Plebhash, Reese Russel, Sjors Provoost, Steve Lee.</p>\n<h2>Appendix A: Benchmarking Setup and Methodology</h2>\n<p><strong>This appendix outlines the complete setup, configurations, tools, and assumptions used in the SV2 vs SV1 benchmarking process.</strong></p>\n<p>The benchmarking was conducted at Hashlabs facilities using two identical hardware devices <strong>ASIC S19k Pro 120Th</strong>, running stock firmware (MD5:a859d95a7110b29b0b70e3e681a5aa2c 2024-04-12) each configured to run separately on SV1 and SV2. The tests were performed under controlled conditions on the Bitcoin mainnet network and Testnet 4 (for measuring block propagation speed) using an <a href=\"https://github.com/stratum-mining/benchmarking-tool\">open-source benchmarking tool.</a> It is important to note that the <strong>benchmarking tool</strong> is in its alpha stage, and there is room for improvement for both SV1 and SV2 stacks.</p>\n<p>All tests were executed via a <strong>dedicated VPS</strong>, which launched the entire benchmarking environment, including pool servers, proxies, and nodes, within <strong>Docker containers</strong>, ensuring all components shared the same hardware resources (CPU, memory, storage).</p>\n<p>To simulate real-world latency conditions, <strong>artificial network delays</strong> were introduced by the <a href=\"https://github.com/stratum-mining/benchmarking-tool\">benchmarking-tool</a>. These delays are dynamically adjusted based on a continuously updated measurement of the <strong>average latency between the benchmarking environment and major mining pools</strong> such as Antpool, Braiins Pool, F2Pool, SpiderPool, Ocean, and ViaBTC. The latency calculation logic is available <a href=\"https://github.com/stratum-mining/benchmarking-tool/tree/main/pools-latency-calculator\">here</a>.</p>\n<p>The SV1 pool was implemented using the open-source <a href=\"https://github.com/benjamin-wilson/public-pool\">public-pool software</a>, while SV2 leveraged the complete suite of applications (Pool, Proxy, JDC, JDS) developed and maintained by <a href=\"https://github.com/stratum-mining/stratum/tree/main/roles\">SRI</a>. The SV2 applications deployed are reference implementations and are not considered production ready. However, the protocol layer of the reference implementation is solid, and developers are encouraged to build production-grade applications on top of it.</p>\n<p>Each SV1 and SV2 pool instance operated with <strong>its own dedicated Bitcoin node</strong>, ensuring isolation and proper protocol-specific behavior. In the <strong>SV2 Configuration with Job Declaration</strong>, the miner also ran <strong>a local Bitcoin node</strong> to enable block template construction.</p>\n<p>We evaluated usage across two SV2 configurations and compared them to SV1:</p>\n<ol>\n<li><strong>Without Job Declaration (JD):</strong> Uses a Translation Proxy (tProxy) to enable SV1 firmware miners to connect to an SV2 pool without requiring a full node.</li>\n<li><strong>With Job Declaration (JD):</strong> Deploys the complete SV2 stack (including a local Bitcoin node on the miner side). It grants miners control over block template construction but increases miner-side bandwidth, due to running a local Bitcoin node.</li>\n</ol>\n"
  },
  {
    "slug": "sri-roadmap-2025",
    "title": "SRI Roadmap: Q4 2024 - 2025",
    "description": "Today, we’re sharing the  (Stratum Reference Implementation) roadmap providing insights into our ongoing work and the project's direction. Additionally, we are publishing the latest progress on Stratum V2 protocol specifications, further emphasizing our commitment to openness and building in public.",
    "date": "2024-11-07",
    "formattedDate": "Nov 7, 2024",
    "authors": [
      "Pavlenex"
    ],
    "tags": [
      "StratumV2",
      "Sri",
      "Roadmap"
    ],
    "content": "\r\nAs we enter Q4 2024, the Stratum V2 Reference Implementation (SRI) project is focused on achieving key objectives that will pave the way for broader adoption in 2025.\r\n\r\nWith a skilled and focused team of core contributors, our main goal is to **secure SRI adoption** in 2025 by supporting one or more early adopters (in addition to [Demand](https://www.dmnd.work)) in launching an SV2 Pool.\r\n\r\nWe plan to achieve this through:\r\n\r\n- **Refining low-level APIs**: Ensuring the protocol crates are thoroughly documented and production-ready. (currently in beta)\r\n- **Close collaboration with early adopters**: Actively working with early adopters to support their SV2 journey and ensure the project aligns with actual market needs\r\n- **Refactoring high-level (application) roles**: Initiating refactoring efforts with the guidance and feedback of early adopters and getting roles into beta and eventually production-ready state (currently in alpha)\r\n\r\nOur primary development objective is to **refine our APIs** through comprehensive documentation and refactoring. This is complemented by the implementation of a **new integration test framework** to ensure codebase stability and predictable component interactions.\r\n\r\nOur secondary development goal centers around **close collaboration with early adopters**. This interaction helps us achieve two things: a better understanding of market requirements and valuable contributions from early adopters, which will accelerate the **refactoring** and **production-readiness** of the most used **roles** (applications).\r\n\r\nCurrently, a few early adopters, despite being aware of the alpha state of the application-level roles, have begun building on these roles. Several adopters are using them with the goal of launching a beta or **production-ready SV2 Pool** in 2025. For this reason, we’re proposing to shift from our original plan to focus solely on low-level APIs.\r\n\r\n![Roadmap Meme](/assets/sri-roadmap-meme.jpg)\r\n\r\nGetting real user feedback during development is something we’ve been waiting for a long time, and now that early adopters are engaging with SRI, it’s crucial to adapt to this reality. If we remain solely focused on refining low-level protocols while early adopters are actively building on the high-level roles, we risk creating a bottleneck that could leave early adopters waiting for months while we finalize the necessary refactoring.\r\n\r\nTo address this, the roadmap suggests a **balanced approach**. Part of the core team will continue to prioritize low-level protocol work, but another part should actively engage with early adopters to understand their specific needs at the application level, documenting those needs and ensure the most requested features are in place. We should ideally aim to motivate early adopters to help us through direct or indirect contributions to our codebase.\r\n\r\nThis means our team needs to be in sync, adapting to this new situation and plan out how to tackle these efforts nearly in parallel. It’s suggested that we don’t start working on roles until a new testing suite is in place. Once that is done, we should work with early adopters, getting as much feedback as we can on roles, encouraging them to contribute back to our codebase, as we work on protocols.\r\n\r\nBelow, is a high-level look at our roadmap for the next few months. This plan focuses on improving the maturity of our codebase through protocol refactoring, specification stabilization, and removing technical debt, all while keeping early adopters engaged and supported throughout the process, aiming to initiate work on roles, always having the same mission: SRI adoption. It it's a dynamic plan, subject to change depending on early adopter interactions.\r\n\r\nHigher-resolution image available [here](https://drive.google.com/file/d/1CWFt9o7NOFYfdJrgashLlsAagz7PBZxO/view?usp=sharing) | [Figma File](https://www.figma.com/design/JOgHHrAeRYLHjn6Hc2Hfle/SRI-Roadmap-2024%2F25?node-id=0-1&t=woeUq9LRsGTiT3Ly-1)\r\n\r\n![Roadmap ](/assets//SRI-Roadmap-2024.png)\r\n\r\n## October\r\n\r\n- SRI **1.1.0 launch.** This release includes the base for comprehensive protocol documentation, and addition of the integration tests framework.\r\n- We are establishing regular **communication channels and dedicated support** for all potential adopters and the core team. This involves organizing calls and support channels to ensure a smooth adoption process.\r\n- A dedicated [auditor role](https://github.com/stratum-mining/stratum/discussions/1052) working group is being established to explore the specifics of the auditor role. This role will focus on transparency and accountability of shares, addressing the need for better auditing processes in mining operations.\r\n- Cleaning up the **Mining Protocol Specs** [#98](https://github.com/stratum-mining/sv2-spec/pull/98)\r\n\r\n## December\r\n\r\n- Add variable difficulty feature to the pool\r\n- Launch SRI 1.2.0 - ensures protocol crates are all well documented and finalized and integration tests framework together with tests is in place, basically unifying the efforts that started in the past 2-3 months.\r\n- Begin estimation on refactoring and improvements for protocols\r\n- Continue our Auditor Role research alongside the development efforts.\r\n- Benchmarking Case Study launched by an adopter, showcasing the advantages of SV2 in a real-world scenario. This case study will serve as a proof point to illustrate SV2’s benefits to other potential adopters.\r\n- Encouraging early adopters to contribute back to SRI to avoid code fragmentation and ensure easier maintenance long-term (these contributions will most likely be in roles)\r\n\r\n## January\r\n\r\n- During this period, we are also focusing on **migrating the Message Generator** (MG) to a separate repository to better modularize the codebase.\r\n- Continue our **Auditor Role research** alongside the development efforts.\r\n  Simultaneously, we should kick off early firmware research inspired by [this doc](https://docs.google.com/document/u/1/d/1iW48-Y4Xvr2IN7PU_9xYw-i5wReCQ98SyliI55_LSos/edit).\r\n\r\n## February-March\r\n\r\n- One of our key objectives is to see an **early adopter deploy SV2** in their production environment.\r\n- **Auditor Role Specification proposal** based on the research conducted in Q4 2024.\r\n- **1.3.0 Launch** is scheduled for March, which should also finalize our protocol level refactorings.\r\n- Migrating Message generator out of the main repository.\r\n\r\n## Future\r\n\r\nMoving forward, our goal is to work towards beta and eventually **production-ready applications** by refining and solidifying all critical components, ensuring the protocol is battle tested for widespread adoption.\r\n",
    "html": "<p>As we enter Q4 2024, the Stratum V2 Reference Implementation (SRI) project is focused on achieving key objectives that will pave the way for broader adoption in 2025.</p>\n<p>With a skilled and focused team of core contributors, our main goal is to <strong>secure SRI adoption</strong> in 2025 by supporting one or more early adopters (in addition to <a href=\"https://www.dmnd.work\">Demand</a>) in launching an SV2 Pool.</p>\n<p>We plan to achieve this through:</p>\n<ul>\n<li><strong>Refining low-level APIs</strong>: Ensuring the protocol crates are thoroughly documented and production-ready. (currently in beta)</li>\n<li><strong>Close collaboration with early adopters</strong>: Actively working with early adopters to support their SV2 journey and ensure the project aligns with actual market needs</li>\n<li><strong>Refactoring high-level (application) roles</strong>: Initiating refactoring efforts with the guidance and feedback of early adopters and getting roles into beta and eventually production-ready state (currently in alpha)</li>\n</ul>\n<p>Our primary development objective is to <strong>refine our APIs</strong> through comprehensive documentation and refactoring. This is complemented by the implementation of a <strong>new integration test framework</strong> to ensure codebase stability and predictable component interactions.</p>\n<p>Our secondary development goal centers around <strong>close collaboration with early adopters</strong>. This interaction helps us achieve two things: a better understanding of market requirements and valuable contributions from early adopters, which will accelerate the <strong>refactoring</strong> and <strong>production-readiness</strong> of the most used <strong>roles</strong> (applications).</p>\n<p>Currently, a few early adopters, despite being aware of the alpha state of the application-level roles, have begun building on these roles. Several adopters are using them with the goal of launching a beta or <strong>production-ready SV2 Pool</strong> in 2025. For this reason, we’re proposing to shift from our original plan to focus solely on low-level APIs.</p>\n<p><img src=\"/assets/sri-roadmap-meme.jpg\" alt=\"Roadmap Meme\"></p>\n<p>Getting real user feedback during development is something we’ve been waiting for a long time, and now that early adopters are engaging with SRI, it’s crucial to adapt to this reality. If we remain solely focused on refining low-level protocols while early adopters are actively building on the high-level roles, we risk creating a bottleneck that could leave early adopters waiting for months while we finalize the necessary refactoring.</p>\n<p>To address this, the roadmap suggests a <strong>balanced approach</strong>. Part of the core team will continue to prioritize low-level protocol work, but another part should actively engage with early adopters to understand their specific needs at the application level, documenting those needs and ensure the most requested features are in place. We should ideally aim to motivate early adopters to help us through direct or indirect contributions to our codebase.</p>\n<p>This means our team needs to be in sync, adapting to this new situation and plan out how to tackle these efforts nearly in parallel. It’s suggested that we don’t start working on roles until a new testing suite is in place. Once that is done, we should work with early adopters, getting as much feedback as we can on roles, encouraging them to contribute back to our codebase, as we work on protocols.</p>\n<p>Below, is a high-level look at our roadmap for the next few months. This plan focuses on improving the maturity of our codebase through protocol refactoring, specification stabilization, and removing technical debt, all while keeping early adopters engaged and supported throughout the process, aiming to initiate work on roles, always having the same mission: SRI adoption. It it’s a dynamic plan, subject to change depending on early adopter interactions.</p>\n<p>Higher-resolution image available <a href=\"https://drive.google.com/file/d/1CWFt9o7NOFYfdJrgashLlsAagz7PBZxO/view?usp=sharing\">here</a> | <a href=\"https://www.figma.com/design/JOgHHrAeRYLHjn6Hc2Hfle/SRI-Roadmap-2024%2F25?node-id=0-1&amp;t=woeUq9LRsGTiT3Ly-1\">Figma File</a></p>\n<p><img src=\"/assets//SRI-Roadmap-2024.png\" alt=\"Roadmap \"></p>\n<h2>October</h2>\n<ul>\n<li>SRI <strong>1.1.0 launch.</strong> This release includes the base for comprehensive protocol documentation, and addition of the integration tests framework.</li>\n<li>We are establishing regular <strong>communication channels and dedicated support</strong> for all potential adopters and the core team. This involves organizing calls and support channels to ensure a smooth adoption process.</li>\n<li>A dedicated <a href=\"https://github.com/stratum-mining/stratum/discussions/1052\">auditor role</a> working group is being established to explore the specifics of the auditor role. This role will focus on transparency and accountability of shares, addressing the need for better auditing processes in mining operations.</li>\n<li>Cleaning up the <strong>Mining Protocol Specs</strong> <a href=\"https://github.com/stratum-mining/sv2-spec/pull/98\">#98</a></li>\n</ul>\n<h2>December</h2>\n<ul>\n<li>Add variable difficulty feature to the pool</li>\n<li>Launch SRI 1.2.0 - ensures protocol crates are all well documented and finalized and integration tests framework together with tests is in place, basically unifying the efforts that started in the past 2-3 months.</li>\n<li>Begin estimation on refactoring and improvements for protocols</li>\n<li>Continue our Auditor Role research alongside the development efforts.</li>\n<li>Benchmarking Case Study launched by an adopter, showcasing the advantages of SV2 in a real-world scenario. This case study will serve as a proof point to illustrate SV2’s benefits to other potential adopters.</li>\n<li>Encouraging early adopters to contribute back to SRI to avoid code fragmentation and ensure easier maintenance long-term (these contributions will most likely be in roles)</li>\n</ul>\n<h2>January</h2>\n<ul>\n<li>During this period, we are also focusing on <strong>migrating the Message Generator</strong> (MG) to a separate repository to better modularize the codebase.</li>\n<li>Continue our <strong>Auditor Role research</strong> alongside the development efforts.\nSimultaneously, we should kick off early firmware research inspired by <a href=\"https://docs.google.com/document/u/1/d/1iW48-Y4Xvr2IN7PU_9xYw-i5wReCQ98SyliI55_LSos/edit\">this doc</a>.</li>\n</ul>\n<h2>February-March</h2>\n<ul>\n<li>One of our key objectives is to see an <strong>early adopter deploy SV2</strong> in their production environment.</li>\n<li><strong>Auditor Role Specification proposal</strong> based on the research conducted in Q4 2024.</li>\n<li><strong>1.3.0 Launch</strong> is scheduled for March, which should also finalize our protocol level refactorings.</li>\n<li>Migrating Message generator out of the main repository.</li>\n</ul>\n<h2>Future</h2>\n<p>Moving forward, our goal is to work towards beta and eventually <strong>production-ready applications</strong> by refining and solidifying all critical components, ensuring the protocol is battle tested for widespread adoption.</p>\n"
  },
  {
    "slug": "sri-1.0.0",
    "title": "Introducing SRI 1.0.0 - the most important milestone in our Stratum V2 journey!",
    "description": "We are thrilled to announce the launch of SRI 1.0.0! This marks an important milestone in our mission to decentralize and enhance bitcoin mining and stands ready for immediate testing and integration.",
    "date": "2024-03-21",
    "formattedDate": "Mar 21, 2024",
    "authors": [
      "Pavlenex"
    ],
    "tags": [
      "StratumV2",
      "SRI",
      "Release"
    ],
    "content": "\r\nWe are thrilled to announce the launch of SRI [1.0.0](https://github.com/stratum-mining/stratum/releases)! This marks an important milestone in our mission to decentralize and enhance bitcoin mining and stands ready for immediate testing and integration.\r\n\r\nStart your SV2 journey with our [getting started guide](https://stratumprotocol.org/getting-started/).\r\n\r\n## 🛎️ Key highlights\r\n\r\n[![SRI 1.0.0 Announcement](https://img.youtube.com/vi/cyduxNB5R7E/mqdefault.jpg)](https://www.youtube.com/watch?v=cyduxNB5R7E)\r\n\r\n### 👷 Miners\r\n\r\n- Connect to a SV2 pool without upgrading existing SV1 firmware through Translation Proxy or\r\n- Connect to an SV2 pool directly with an SV2 firmware device (BraiinsOS)\r\n- Run you own bitcoin node, construct templates, and declare them to the SV2 Pool\r\n- Utilize pool fallback functionality in case the pool decides to censor\r\n\r\n### 🛠️ Pools\r\n\r\n- Deploy and operate a very simple SV2 Pool\r\n- Integrate SV2 into an existing pool through our libraries\r\n\r\nThe new version is a result of improvements in the Stratum V2 [specification](https://github.com/stratum-mining/sv2-spec) through the working [group](https://www.cnbc.com/2022/10/11/bitcoin-mining-software-overhaul-stratum-v2-promoted-by-block-braiins.html) collaboration and rigorous testing with our interoperability suite to ensure compatibility between the two implementations of the Stratum V2 protocol.\r\n\r\nAs we planned [eight months ago](https://stratumprotocol.org/blog/sri-roadmap-2023/), the release allows miners running SV1 or SV2 firmware to connect to an SV2 Pool (directly or through a translation proxy), optionally using a locally hosted Job Declaration Client and a patched version of a Bitcoin Core Node to **construct their own block templates** which are then sent to the Job Declarator Server run by the SV2 Pool. It’s important to mention that our code refactoring introduced the ability for the node and JDC to be run by an independent third-party, not just the miners.\r\n\r\n![Config A](/assets/config-a.svg)\r\n\r\nThe newly implemented **pool fallback functionality** ensures that if a pool rejects a miner's template, the miner's Job Declarator Client automatically switches to an alternative pool. Miners can configure several fallback options and if all listed pools decide to censor, miners will end up solo mining. This serves as a powerful incentive for pools to act in the best interest of miners, as rejecting templates without a valid reason could lead to a significant loss of hash power to competitors. If all miners run standardized software, the entire hash rate of the pool could end up with a competing pool.\r\n\r\nAside from pools rejecting templates with transactions they wish to censor, there are several other scenarios where template rejection could trigger the pool fallback feature:\r\n\r\n- A bug in the pool or downstream\r\n- A connection interruption between the pool and downstream\r\n- Downstream creates custom templates below the acceptable fee policy defined by the pool\r\n\r\n**SRI’s pool** is simple and opinionated and currently can receive a template from the Template Provider, and create jobs for the downstream with the adequate difficulty. Anyone can easily deploy this simple pool today or use our libraries to integrate into their existing operations. Going forward, we plan to continue refactoring our code to allow for more diverse use-cases. Anyone interested in integrating SV2 into an existing pool, or starting a brand-new pool, [let us know](https://discord.gg/stEjAZ2y8r), we’d love to collaborate more closely. One example of a pool using SRI in production is [DMND](https://www.dmnd.work/).\r\n\r\n**Template Provider** enables the selection of transactions from the locally-run bitcoin node. Miners (soon, also independent third parties) can create custom block templates and declare custom mining jobs to the pool. Currently, to use the Template Provider you need to use our patched version of Bitcoin Core. Sjors Provoost opened a pull request in the Bitcoin Core repo [#29432](https://github.com/bitcoin/bitcoin/pull/29432) which can be tested and reviewed. We’re inviting code reviewers to take a look at smaller PR’s that build [#2943](https://github.com/bitcoin/bitcoin/pull/29432).\r\n\r\n## 🙏 Thank you!\r\n\r\nSRI 1.0.0 wouldn’t be possible without our contributors, supporters, working group, testers, and community. Since our last update, our contributor base has grown even further! What once started as a one-man project, is now a community of contributors building backbone infrastructure for the entire mining industry.\r\n\r\nA huge shout-out to: fi3, gitgab19, pavlenex, plebhash, priceless-p, satsie, sjors, ccdle12, darricksee, jakubtrnka, lobarrel, lorbax, rrybarczyk, vincenzopalazzo, 4ss0, 0xSaksham and many more!\r\n\r\nThanks to [HRF](http://hrf.org), [OpenSats](https://opensats.org), and [Spiral](http://spiral.xyz) for supporting contributors through grants and donations, ensuring the project's sustainability.\r\nSpecial thanks to [Santacroce](https://santacroce.xyz/), [Hut8](http://hut8.io), and Oblast63 for providing the equipment for community testing, and to the working group members, including [Braiins](https://braiins.com) and others, for their role in refining the specifications.\r\n\r\n## 🎁 Support us\r\n\r\n- Individuals can support the development and maintenance of the SRI by [donating through OpenSats](https://opensats.org/projects/stratumv2), a 501(c)(3) public charity dedicated to supporting open-source Bitcoin projects.\r\n- Corporate entities interested in providing grants to SRI contributors, please get in touch with us directly. Your support can make a significant difference in accelerating development, research, and innovation. Please [get in touch](mailto:stratumv2@gmail.com)\r\n- Contribute - We’re inviting developers interested in contributing to SRI to look into our codebase, study the specs and join our regular weekly developer meetings on Discord to get up to speed and get proper onboarding.\r\n\r\n## 🏁 Dive in\r\n\r\nAfter months of testing, including over [600 blocks](https://mempool.space/testnet/address/tb1qa0sm0hxzj0x25rh8gw5xlzwlsfvvyz8u96w3p8) mined on testnet, we are confident to invite you to [experience SRI 1.0.0](https://stratumprotocol.org/getting-started/) firsthand.\r\n\r\nYour feedback, issue reports, and feature suggestions are invaluable to us, directly shaping the future of SRI. For the most straightforward experience, consider running the full stack locally or connecting to our community-supported infrastructure.\r\n\r\nTo ensure SRI 1.0.0 works seamlessly across various setups, we encourage you to [share your testing experience](https://forms.gle/QAX3hriMzKAMELFB6).\r\n\r\nPlease [report](https://github.com/stratum-mining/stratum/issues) any inconveniences or bugs, and feel free to ask for assistance through [Discord](https://discord.gg/stEjAZ2y8r). Your active participation is crucial in refining and enhancing our software for everyone.\r\n\r\n**Start your SV2 journey [here](https://stratumprotocol.org/getting-started/).**\r\n",
    "html": "<p>We are thrilled to announce the launch of SRI <a href=\"https://github.com/stratum-mining/stratum/releases\">1.0.0</a>! This marks an important milestone in our mission to decentralize and enhance bitcoin mining and stands ready for immediate testing and integration.</p>\n<p>Start your SV2 journey with our <a href=\"https://stratumprotocol.org/getting-started/\">getting started guide</a>.</p>\n<h2>🛎️ Key highlights</h2>\n<p><a href=\"https://www.youtube.com/watch?v=cyduxNB5R7E\"><img src=\"https://img.youtube.com/vi/cyduxNB5R7E/mqdefault.jpg\" alt=\"SRI 1.0.0 Announcement\"></a></p>\n<h3>👷 Miners</h3>\n<ul>\n<li>Connect to a SV2 pool without upgrading existing SV1 firmware through Translation Proxy or</li>\n<li>Connect to an SV2 pool directly with an SV2 firmware device (BraiinsOS)</li>\n<li>Run you own bitcoin node, construct templates, and declare them to the SV2 Pool</li>\n<li>Utilize pool fallback functionality in case the pool decides to censor</li>\n</ul>\n<h3>🛠️ Pools</h3>\n<ul>\n<li>Deploy and operate a very simple SV2 Pool</li>\n<li>Integrate SV2 into an existing pool through our libraries</li>\n</ul>\n<p>The new version is a result of improvements in the Stratum V2 <a href=\"https://github.com/stratum-mining/sv2-spec\">specification</a> through the working <a href=\"https://www.cnbc.com/2022/10/11/bitcoin-mining-software-overhaul-stratum-v2-promoted-by-block-braiins.html\">group</a> collaboration and rigorous testing with our interoperability suite to ensure compatibility between the two implementations of the Stratum V2 protocol.</p>\n<p>As we planned <a href=\"https://stratumprotocol.org/blog/sri-roadmap-2023/\">eight months ago</a>, the release allows miners running SV1 or SV2 firmware to connect to an SV2 Pool (directly or through a translation proxy), optionally using a locally hosted Job Declaration Client and a patched version of a Bitcoin Core Node to <strong>construct their own block templates</strong> which are then sent to the Job Declarator Server run by the SV2 Pool. It’s important to mention that our code refactoring introduced the ability for the node and JDC to be run by an independent third-party, not just the miners.</p>\n<p><img src=\"/assets/config-a.svg\" alt=\"Config A\"></p>\n<p>The newly implemented <strong>pool fallback functionality</strong> ensures that if a pool rejects a miner’s template, the miner’s Job Declarator Client automatically switches to an alternative pool. Miners can configure several fallback options and if all listed pools decide to censor, miners will end up solo mining. This serves as a powerful incentive for pools to act in the best interest of miners, as rejecting templates without a valid reason could lead to a significant loss of hash power to competitors. If all miners run standardized software, the entire hash rate of the pool could end up with a competing pool.</p>\n<p>Aside from pools rejecting templates with transactions they wish to censor, there are several other scenarios where template rejection could trigger the pool fallback feature:</p>\n<ul>\n<li>A bug in the pool or downstream</li>\n<li>A connection interruption between the pool and downstream</li>\n<li>Downstream creates custom templates below the acceptable fee policy defined by the pool</li>\n</ul>\n<p><strong>SRI’s pool</strong> is simple and opinionated and currently can receive a template from the Template Provider, and create jobs for the downstream with the adequate difficulty. Anyone can easily deploy this simple pool today or use our libraries to integrate into their existing operations. Going forward, we plan to continue refactoring our code to allow for more diverse use-cases. Anyone interested in integrating SV2 into an existing pool, or starting a brand-new pool, <a href=\"https://discord.gg/stEjAZ2y8r\">let us know</a>, we’d love to collaborate more closely. One example of a pool using SRI in production is <a href=\"https://www.dmnd.work/\">DMND</a>.</p>\n<p><strong>Template Provider</strong> enables the selection of transactions from the locally-run bitcoin node. Miners (soon, also independent third parties) can create custom block templates and declare custom mining jobs to the pool. Currently, to use the Template Provider you need to use our patched version of Bitcoin Core. Sjors Provoost opened a pull request in the Bitcoin Core repo <a href=\"https://github.com/bitcoin/bitcoin/pull/29432\">#29432</a> which can be tested and reviewed. We’re inviting code reviewers to take a look at smaller PR’s that build <a href=\"https://github.com/bitcoin/bitcoin/pull/29432\">#2943</a>.</p>\n<h2>🙏 Thank you!</h2>\n<p>SRI 1.0.0 wouldn’t be possible without our contributors, supporters, working group, testers, and community. Since our last update, our contributor base has grown even further! What once started as a one-man project, is now a community of contributors building backbone infrastructure for the entire mining industry.</p>\n<p>A huge shout-out to: fi3, gitgab19, pavlenex, plebhash, priceless-p, satsie, sjors, ccdle12, darricksee, jakubtrnka, lobarrel, lorbax, rrybarczyk, vincenzopalazzo, 4ss0, 0xSaksham and many more!</p>\n<p>Thanks to <a href=\"http://hrf.org\">HRF</a>, <a href=\"https://opensats.org\">OpenSats</a>, and <a href=\"http://spiral.xyz\">Spiral</a> for supporting contributors through grants and donations, ensuring the project’s sustainability.\nSpecial thanks to <a href=\"https://santacroce.xyz/\">Santacroce</a>, <a href=\"http://hut8.io\">Hut8</a>, and Oblast63 for providing the equipment for community testing, and to the working group members, including <a href=\"https://braiins.com\">Braiins</a> and others, for their role in refining the specifications.</p>\n<h2>🎁 Support us</h2>\n<ul>\n<li>Individuals can support the development and maintenance of the SRI by <a href=\"https://opensats.org/projects/stratumv2\">donating through OpenSats</a>, a 501©(3) public charity dedicated to supporting open-source Bitcoin projects.</li>\n<li>Corporate entities interested in providing grants to SRI contributors, please get in touch with us directly. Your support can make a significant difference in accelerating development, research, and innovation. Please <a href=\"mailto:stratumv2@gmail.com\">get in touch</a></li>\n<li>Contribute - We’re inviting developers interested in contributing to SRI to look into our codebase, study the specs and join our regular weekly developer meetings on Discord to get up to speed and get proper onboarding.</li>\n</ul>\n<h2>🏁 Dive in</h2>\n<p>After months of testing, including over <a href=\"https://mempool.space/testnet/address/tb1qa0sm0hxzj0x25rh8gw5xlzwlsfvvyz8u96w3p8\">600 blocks</a> mined on testnet, we are confident to invite you to <a href=\"https://stratumprotocol.org/getting-started/\">experience SRI 1.0.0</a> firsthand.</p>\n<p>Your feedback, issue reports, and feature suggestions are invaluable to us, directly shaping the future of SRI. For the most straightforward experience, consider running the full stack locally or connecting to our community-supported infrastructure.</p>\n<p>To ensure SRI 1.0.0 works seamlessly across various setups, we encourage you to <a href=\"https://forms.gle/QAX3hriMzKAMELFB6\">share your testing experience</a>.</p>\n<p>Please <a href=\"https://github.com/stratum-mining/stratum/issues\">report</a> any inconveniences or bugs, and feel free to ask for assistance through <a href=\"https://discord.gg/stEjAZ2y8r\">Discord</a>. Your active participation is crucial in refining and enhancing our software for everyone.</p>\n<p><strong>Start your SV2 journey <a href=\"https://stratumprotocol.org/getting-started/\">here</a>.</strong></p>\n"
  },
  {
    "slug": "getting-started",
    "title": "",
    "description": "",
    "date": "2024-01-01",
    "formattedDate": "Jan 1, 2024",
    "authors": [],
    "tags": [],
    "content": "\n# Getting Started with running SRI - Stratum V2 reference implementation\n\nThis document aims to assist users in deploying the SRI software stack efficiently. Stratum V2 as a protocol is flexible, and allows users to run multiple configurations. In the getting started guide, we're focusing on running [roles](https://stratumprotocol.org/docs/#roles) which allow miners to construct their own block templates. \n\n![SRI ](/assets/Sri-AllRoles.png)\n\n## Prerequisites\n\nRust installed on your machine. If it's not:\n\n```bash\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n```\nThere are two primary ways to use all roles:  \n\n- Run certain roles and connecting to our community-hosted roles. (The easiest way to test SRI)\n- Run all roles (Recommended way)\n\n## I Getting Started - The easiest way\n\n**Objective**: Give Stratum V2 a try, mine blocks on the testnet with minimal setup.\n\n- Community-hosted roles used: SV2 Pool, testnet Template Provider, and Job Declarator Server.\n- Self-hosted roles to run: Job Declarator Client (JDC) and Translator Proxy.\n\n### Step 1: Setup and Configuration\n\n#### Clone the repository\n\n```bash\ngit clone https://github.com/stratum-mining/stratum.git\n```\n#### Run Job Declarator Client (JDC)\n```bash\ncd roles/jd-client/config-examples/\ncargo run -- -c jdc-config-hosted-example.toml\n```\n#### Run Translator Proxy\n\n```bash\ncd roles/translator/config-examples/\ncargo run -- -c tproxy-config-local-jdc-example.toml\n```\n#### Connect mining devices\n\nConnect mining device - Translator Proxy will be running on port `34255`, so you will need just to edit your mining device(s) configuration, adding the line:\n\n`stratum+tcp://<tProxy ip>:34255`\n\n#### CPU Miner\nIf you don't have a physical miner, you can do tests with CPUMiner.\n\nSetup the correct CPUMiner for your OS:\n- You can download the binary directly from [here](https://sourceforge.net/projects/cpuminer/files/);\n- Or compile it from [https://github.com/pooler/cpuminer](https://github.com/pooler/cpuminer)\n\nOn the CPUMiner directory:\n \n```bash\n./minerd -a sha256d -o stratum+tcp://localhost:34255 -q -D -P\n```\n\n#### Adjust proxy-config (optional)\n\nDepending on mining device you do run, you may have to adjust `tproxy-config-local-jdc-example.toml` file in order to adjust the `min_individual_miner_hashrate` and `channel_nominal_hashrate` parameters accordingly\n\n\n## II Getting Started - Running all roles \n\n**Objective**: Establish a complete, self-hosted Stratum V2 environment for comprehensive testing and deeper understanding of all components.\n\n### Step 1: Setup and Configuration\n\n#### Run Template Provider\n\nDownload a release from Sjors' fork of Bitcoin Core from https://github.com/Sjors/bitcoin/releases\n\nEdit the `bitcoin.conf` file stored in `~/.bitcoin/` by adding:\n```ini\n[testnet4]\nserver=1\nrpcuser=username\nrpcpassword=password\n```\n\nUnpack the Template Provider. For example, assuming you downloaded `bitcoin-sv2-tp-0.1.15-x86_64-linux-gnu.tar.gz`:\n\n```bash\ntar xvf bitcoin-sv2-tp-0.1.15-x86_64-linux-gnu.tar.gz\n```\n\n⚠️ Note: macOS binaries are not code signed. Read release notes for instructions on how to proceed.\n\nStart the Template Provider.\n\n```bash\n./bitcoin-sv2-tp-0.1.15/bin/bitcoind -testnet4 -sv2 -sv2port=8442 -debug=sv2 \n```\n\n⚠️ Note: you need to wait until `bitcoind` is fully synced with the testnet before you proceed.\n\nOptional parameters:\n\nThere are optional parameters which can be used to better manage the Template Provider:\n- `sv2interval` - sets how often a new template is built (default is 30s)\n- `sv2feedelta` - defines the delta fees to reach before sending new templates to downstreams (default is 1000 sats)\n- `loglevel=sv2:trace` to get more detailed debugging\n\nFor example: \n\n```bash\n./bitcoin-sv2-tp-0.1.15/bin/bitcoind -testnet4 -sv2 -sv2port=8442 -sv2interval=20 -sv2feedelta=1000 -debug=sv2 -loglevel=sv2:trace\n```\nThis way new templates are constructed every 20 seconds (taking the most profitable txs from the mempool) and they are sent downstream if new fees collected are more than 1000 sats. \n\n#### Clone the repository\n\n```bash\ngit clone https://github.com/stratum-mining/stratum.git\n```\n#### Run the SV2 Pool\n\n```bash\ncd roles/pool/config-examples\ncargo run -- -c pool-config-local-tp-example.toml\n```\n#### Run the Job Declarator Server (JDS)\n\n```bash\ncd roles/jd-server/config-examples\ncargo run -- -c jds-config-local-example.toml\n```\n#### Run Job Declarator Client (JDC)\n\n```bash\ncd roles/jd-client/config-examples/\ncargo run -- -c jdc-config-local-example.toml\n```\n#### Run Translator Proxy\n\n```bash\ncd roles/translator/config-examples/\ncargo run -- -c tproxy-config-local-jdc-example.toml\n```\n#### Connect Mining Devices\n\nConnect mining device - Translator Proxy will be running on port `34255`, so you will need just to edit your mining device(s) configuration, adding the line:\n\n`stratum+tcp://<tProxy ip>:34255`\n#### CPU Miner\nIf you don't have a physical miner, you can do tests with CPUMiner.\n\nSetup the correct CPUMiner for your OS:\n- You can download the binary directly from [here](https://sourceforge.net/projects/cpuminer/files/);\n- Or compile it from [https://github.com/pooler/cpuminer](https://github.com/pooler/cpuminer)\n\nOn the CPUMiner directory:\n \n```bash\n./minerd -a sha256d -o stratum+tcp://localhost:34255 -q -D -P\n```\n## III Final Step: monitoring for blocks\n\nOnce set up, monitor the machines and role logs for any valid blocks found.\n\nFollowing pictures detail the logs from tProxy, JDC, and Pool when a block is found.\n\nPool logs\n\n![SRI Pool](/assets/SV2Pool-logs.png)\n\nJob Declarator Client (JDC) logs\n\n![SRI JDC](/assets/JobDeclaratorClient-JDC-logs.png)\n\nTranslation Proxy tProxy logs\n\n![SRI tProxy](/assets/TranslationProxy-tProxy-logs.png) \n\n### Monitor for mined blocks on Testnet\n\nIf you didn't change anything in the configuration files present in every role subdirectory, the valid block mined will be recognized by the string `Stratum V2 SRI Pool (0x5374726174756d2076322053524920506f6f6c)` inserted into the scriptSig of the coinbase tx input. \n\nA way to look for it is to check the address `tb1qa0sm0hxzj0x25rh8gw5xlzwlsfvvyz8u96w3p8` since the default coinbase output is configured to be a P2WPKH built with a public key = `036adc3bdf21e6f9a0f0fb0066bf517e5b7909ed1563d6958a10993849a7554075`\n\nYou can perform a search on one of the following block explorers:\n- [mempool.space/testnet](https://mempool.space/testnet)\n- [blockstream.info/testnet](https://blockstream.info/testnet/)\n\n## IV Customizing configuration\n\n### Customize the “pool_signature” string\nTo customize the string which is inserted into the `scriptSig` of the coinbase tx input, you need to run every role locally. To make changes, edit the `pool_signature` field present in:\n- roles/pool/config-examples/pool-config-local-tp-example.toml\n- roles/jd-client/config-examples/jdc-config-local-example.toml\n\nDouble check that the strings are equal and that you save your changes in both configuration files!\n\n### Customize the coinbase tx output script\nTo customize the coinbase tx output script, you need to run every role locally. To make changes, edit the `coinbase_output` field present in:\n- roles/jd-client/config-examples/jdc-config-local-example.toml\n- roles/jd-server/config-examples/jd-server-config-local-example.toml\n\nYou can use any of the following script types:  P2PK,P2PKH, P2WPKH, P2SH, P2WSH, P2TR. \nIn case a public key is required, as explained in the config files, you can start by creating a testnet wallet on mobile, using Green wallet, or a desktop one, using Electrum wallet, and extract the extended public key they provide. At this point, you can derive the child public key to use in the configuration files, [using this script](https://github.com/stratum-mining/stratum/tree/dev/utils/bip32-key-derivation).\n\n## Community support\n\nIf you get any issue during testing phase, feel free to [join our community Discord](https://discord.gg/fsEW23wFYs) to get community support or file a [bug report on GitHub](https://github.com/stratum-mining/stratum/issues/new).",
    "html": "<h1>Getting Started with running SRI - Stratum V2 reference implementation</h1>\n<p>This document aims to assist users in deploying the SRI software stack efficiently. Stratum V2 as a protocol is flexible, and allows users to run multiple configurations. In the getting started guide, we’re focusing on running <a href=\"https://stratumprotocol.org/docs/#roles\">roles</a> which allow miners to construct their own block templates.</p>\n<p><img src=\"/assets/Sri-AllRoles.png\" alt=\"SRI \"></p>\n<h2>Prerequisites</h2>\n<p>Rust installed on your machine. If it’s not:</p>\n<pre><code class=\"language-bash\">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\n</code></pre>\n<p>There are two primary ways to use all roles:</p>\n<ul>\n<li>Run certain roles and connecting to our community-hosted roles. (The easiest way to test SRI)</li>\n<li>Run all roles (Recommended way)</li>\n</ul>\n<h2>I Getting Started - The easiest way</h2>\n<p><strong>Objective</strong>: Give Stratum V2 a try, mine blocks on the testnet with minimal setup.</p>\n<ul>\n<li>Community-hosted roles used: SV2 Pool, testnet Template Provider, and Job Declarator Server.</li>\n<li>Self-hosted roles to run: Job Declarator Client (JDC) and Translator Proxy.</li>\n</ul>\n<h3>Step 1: Setup and Configuration</h3>\n<h4>Clone the repository</h4>\n<pre><code class=\"language-bash\">git clone https://github.com/stratum-mining/stratum.git\n</code></pre>\n<h4>Run Job Declarator Client (JDC)</h4>\n<pre><code class=\"language-bash\">cd roles/jd-client/config-examples/\ncargo run -- -c jdc-config-hosted-example.toml\n</code></pre>\n<h4>Run Translator Proxy</h4>\n<pre><code class=\"language-bash\">cd roles/translator/config-examples/\ncargo run -- -c tproxy-config-local-jdc-example.toml\n</code></pre>\n<h4>Connect mining devices</h4>\n<p>Connect mining device - Translator Proxy will be running on port <code>34255</code>, so you will need just to edit your mining device(s) configuration, adding the line:</p>\n<p><code>stratum+tcp://&lt;tProxy ip&gt;:34255</code></p>\n<h4>CPU Miner</h4>\n<p>If you don’t have a physical miner, you can do tests with CPUMiner.</p>\n<p>Setup the correct CPUMiner for your OS:</p>\n<ul>\n<li>You can download the binary directly from <a href=\"https://sourceforge.net/projects/cpuminer/files/\">here</a>;</li>\n<li>Or compile it from <a href=\"https://github.com/pooler/cpuminer\">https://github.com/pooler/cpuminer</a></li>\n</ul>\n<p>On the CPUMiner directory:</p>\n<pre><code class=\"language-bash\">./minerd -a sha256d -o stratum+tcp://localhost:34255 -q -D -P\n</code></pre>\n<h4>Adjust proxy-config (optional)</h4>\n<p>Depending on mining device you do run, you may have to adjust <code>tproxy-config-local-jdc-example.toml</code> file in order to adjust the <code>min_individual_miner_hashrate</code> and <code>channel_nominal_hashrate</code> parameters accordingly</p>\n<h2>II Getting Started - Running all roles</h2>\n<p><strong>Objective</strong>: Establish a complete, self-hosted Stratum V2 environment for comprehensive testing and deeper understanding of all components.</p>\n<h3>Step 1: Setup and Configuration</h3>\n<h4>Run Template Provider</h4>\n<p>Download a release from Sjors’ fork of Bitcoin Core from <a href=\"https://github.com/Sjors/bitcoin/releases\">https://github.com/Sjors/bitcoin/releases</a></p>\n<p>Edit the <code>bitcoin.conf</code> file stored in <code>~/.bitcoin/</code> by adding:</p>\n<pre><code class=\"language-ini\">[testnet4]\nserver=1\nrpcuser=username\nrpcpassword=password\n</code></pre>\n<p>Unpack the Template Provider. For example, assuming you downloaded <code>bitcoin-sv2-tp-0.1.15-x86_64-linux-gnu.tar.gz</code>:</p>\n<pre><code class=\"language-bash\">tar xvf bitcoin-sv2-tp-0.1.15-x86_64-linux-gnu.tar.gz\n</code></pre>\n<p>⚠️ Note: macOS binaries are not code signed. Read release notes for instructions on how to proceed.</p>\n<p>Start the Template Provider.</p>\n<pre><code class=\"language-bash\">./bitcoin-sv2-tp-0.1.15/bin/bitcoind -testnet4 -sv2 -sv2port=8442 -debug=sv2 \n</code></pre>\n<p>⚠️ Note: you need to wait until <code>bitcoind</code> is fully synced with the testnet before you proceed.</p>\n<p>Optional parameters:</p>\n<p>There are optional parameters which can be used to better manage the Template Provider:</p>\n<ul>\n<li><code>sv2interval</code> - sets how often a new template is built (default is 30s)</li>\n<li><code>sv2feedelta</code> - defines the delta fees to reach before sending new templates to downstreams (default is 1000 sats)</li>\n<li><code>loglevel=sv2:trace</code> to get more detailed debugging</li>\n</ul>\n<p>For example:</p>\n<pre><code class=\"language-bash\">./bitcoin-sv2-tp-0.1.15/bin/bitcoind -testnet4 -sv2 -sv2port=8442 -sv2interval=20 -sv2feedelta=1000 -debug=sv2 -loglevel=sv2:trace\n</code></pre>\n<p>This way new templates are constructed every 20 seconds (taking the most profitable txs from the mempool) and they are sent downstream if new fees collected are more than 1000 sats.</p>\n<h4>Clone the repository</h4>\n<pre><code class=\"language-bash\">git clone https://github.com/stratum-mining/stratum.git\n</code></pre>\n<h4>Run the SV2 Pool</h4>\n<pre><code class=\"language-bash\">cd roles/pool/config-examples\ncargo run -- -c pool-config-local-tp-example.toml\n</code></pre>\n<h4>Run the Job Declarator Server (JDS)</h4>\n<pre><code class=\"language-bash\">cd roles/jd-server/config-examples\ncargo run -- -c jds-config-local-example.toml\n</code></pre>\n<h4>Run Job Declarator Client (JDC)</h4>\n<pre><code class=\"language-bash\">cd roles/jd-client/config-examples/\ncargo run -- -c jdc-config-local-example.toml\n</code></pre>\n<h4>Run Translator Proxy</h4>\n<pre><code class=\"language-bash\">cd roles/translator/config-examples/\ncargo run -- -c tproxy-config-local-jdc-example.toml\n</code></pre>\n<h4>Connect Mining Devices</h4>\n<p>Connect mining device - Translator Proxy will be running on port <code>34255</code>, so you will need just to edit your mining device(s) configuration, adding the line:</p>\n<p><code>stratum+tcp://&lt;tProxy ip&gt;:34255</code></p>\n<h4>CPU Miner</h4>\n<p>If you don’t have a physical miner, you can do tests with CPUMiner.</p>\n<p>Setup the correct CPUMiner for your OS:</p>\n<ul>\n<li>You can download the binary directly from <a href=\"https://sourceforge.net/projects/cpuminer/files/\">here</a>;</li>\n<li>Or compile it from <a href=\"https://github.com/pooler/cpuminer\">https://github.com/pooler/cpuminer</a></li>\n</ul>\n<p>On the CPUMiner directory:</p>\n<pre><code class=\"language-bash\">./minerd -a sha256d -o stratum+tcp://localhost:34255 -q -D -P\n</code></pre>\n<h2>III Final Step: monitoring for blocks</h2>\n<p>Once set up, monitor the machines and role logs for any valid blocks found.</p>\n<p>Following pictures detail the logs from tProxy, JDC, and Pool when a block is found.</p>\n<p>Pool logs</p>\n<p><img src=\"/assets/SV2Pool-logs.png\" alt=\"SRI Pool\"></p>\n<p>Job Declarator Client (JDC) logs</p>\n<p><img src=\"/assets/JobDeclaratorClient-JDC-logs.png\" alt=\"SRI JDC\"></p>\n<p>Translation Proxy tProxy logs</p>\n<p><img src=\"/assets/TranslationProxy-tProxy-logs.png\" alt=\"SRI tProxy\"></p>\n<h3>Monitor for mined blocks on Testnet</h3>\n<p>If you didn’t change anything in the configuration files present in every role subdirectory, the valid block mined will be recognized by the string <code>Stratum V2 SRI Pool (0x5374726174756d2076322053524920506f6f6c)</code> inserted into the scriptSig of the coinbase tx input.</p>\n<p>A way to look for it is to check the address <code>tb1qa0sm0hxzj0x25rh8gw5xlzwlsfvvyz8u96w3p8</code> since the default coinbase output is configured to be a P2WPKH built with a public key = <code>036adc3bdf21e6f9a0f0fb0066bf517e5b7909ed1563d6958a10993849a7554075</code></p>\n<p>You can perform a search on one of the following block explorers:</p>\n<ul>\n<li><a href=\"https://mempool.space/testnet\">mempool.space/testnet</a></li>\n<li><a href=\"https://blockstream.info/testnet/\">blockstream.info/testnet</a></li>\n</ul>\n<h2>IV Customizing configuration</h2>\n<h3>Customize the “pool_signature” string</h3>\n<p>To customize the string which is inserted into the <code>scriptSig</code> of the coinbase tx input, you need to run every role locally. To make changes, edit the <code>pool_signature</code> field present in:</p>\n<ul>\n<li>roles/pool/config-examples/pool-config-local-tp-example.toml</li>\n<li>roles/jd-client/config-examples/jdc-config-local-example.toml</li>\n</ul>\n<p>Double check that the strings are equal and that you save your changes in both configuration files!</p>\n<h3>Customize the coinbase tx output script</h3>\n<p>To customize the coinbase tx output script, you need to run every role locally. To make changes, edit the <code>coinbase_output</code> field present in:</p>\n<ul>\n<li>roles/jd-client/config-examples/jdc-config-local-example.toml</li>\n<li>roles/jd-server/config-examples/jd-server-config-local-example.toml</li>\n</ul>\n<p>You can use any of the following script types:  P2PK,P2PKH, P2WPKH, P2SH, P2WSH, P2TR.\nIn case a public key is required, as explained in the config files, you can start by creating a testnet wallet on mobile, using Green wallet, or a desktop one, using Electrum wallet, and extract the extended public key they provide. At this point, you can derive the child public key to use in the configuration files, <a href=\"https://github.com/stratum-mining/stratum/tree/dev/utils/bip32-key-derivation\">using this script</a>.</p>\n<h2>Community support</h2>\n<p>If you get any issue during testing phase, feel free to <a href=\"https://discord.gg/fsEW23wFYs\">join our community Discord</a> to get community support or file a <a href=\"https://github.com/stratum-mining/stratum/issues/new\">bug report on GitHub</a>.</p>\n"
  },
  {
    "slug": "sri-roadmap-2023",
    "title": " Stratum V2 (SRI) Roadmap - To infinity and beyond ",
    "description": "Today, we’re sharing the  (Stratum Reference Implementation) roadmap providing insights into our ongoing work and the project's direction. Additionally, we are publishing the latest progress on Stratum V2 protocol specifications, further emphasizing our commitment to openness and building in public.",
    "date": "2023-08-03",
    "formattedDate": "Aug 3, 2023",
    "authors": [
      "Pavlenex"
    ],
    "tags": [
      "StratumV2",
      "Sri",
      "Roadmap"
    ],
    "content": "\r\nToday, we’re sharing the (Stratum Reference Implementation) **roadmap** providing insights into our ongoing work and the project's direction. Additionally, we are publishing the latest progress on Stratum V2 protocol **specifications**, further emphasizing our commitment to openness and building in public.\r\n\r\nWe believe fostering collaboration and transparency in the development process accelerates community involvement and brings us one step closer to our mission - better, more robust, and more decentralized bitcoin mining.\r\n\r\nAt its core, SRI is a community-driven, open-source project. Our roadmap reflects the consensus reached within the community, constantly evolving with the collective input of every one of us.\r\n\r\nWe welcome you to join us in our mission, start contributing, testing and help us shape the future of bitcoin mining.\r\n\r\n## 📖 Stratum V2 specification\r\n\r\nThe specification is the heart of any protocol. The Stratum V2 specification, meticulously maintained by an independent open-source working group [formed](https://www.cnbc.com/2022/10/11/bitcoin-mining-software-overhaul-stratum-v2-promoted-by-block-braiins.html) in October 2022, is pivotal in defining the functionality. Since its inception, the specs have undergone several updates to enhance security, performance, flexibility, and simplicity.\r\n\r\nThe main goal is to **stabilize** the specification, **formalize** the proposal procedures, and make them **accessible** to anyone interested in improving the Stratum V2.\r\n\r\nThe table below summarizes the changelog of notable specs updates.\r\n\r\n| Notable update                              | Link to a pull request                                     |\r\n| :------------------------------------------ | :--------------------------------------------------------- |\r\n| Noise handshake improvement                 | [#2](https://github.com/stratum-mining/sv2-spec/pull/2)    |\r\n| Using Bitcoin core cryptographic primitives | [#10](https://github.com/stratum-mining/sv2-spec/pull/10)  |\r\n| Replace future_job with min_ntime           | [#12](https://github.com/stratum-mining/sv2-spec/pull/12/) |\r\n| Message framework improvement               | [#40](https://github.com/stratum-mining/sv2-spec/pull/40)  |\r\n| Rename Job Negotiator to Job Declarator     | [#43](https://github.com/stratum-mining/sv2-spec/pull/43)  |\r\n\r\n### Noise handshake improvement\r\n\r\nOne of our first updates is improving the noise handshake. The Stratum V2 protocol updates refine the authenticated key agreement through a three-step process, **enhancing security and communication efficiency**. This includes, an exchange of keys, followed by an Elliptic Curve Diffie-Hellman (ECDH) operation, encryption algorithm negotiation and server authentication through a signature noise message.\r\n\r\n### Using Bitcoin Core cryptographic primitives\r\n\r\nThe PR #10 implemented Bitcoin Core's cryptographic primitives, shifting from curve25519 to secp256k1 and from Blake2s to SHA256 for hashing. It introduces Schnorr/secp256k1 for server authentication, necessitating updates to CA-authority public keys and supports handshake with two different AEAD algorithms. The update **simplifies handshake messages** by eliminating unnecessary length prefixes and thoroughly describes each handshake step, moving the noise-secure layer description into a separate file.\r\n\r\n### Replace future_job with min_ntime\r\n\r\nPreviously, 'future_job' indicated whether a job related to a future or the last sent 'SetNewPrevHash' message on the channel. Now, 'min_ntime' serves this function, remaining empty for future jobs and filled with 'min_ntime' for immediate jobs linked to the last sent 'SetNewPrevHash'. This change offers a more **granular control over job allocation** and initiation in the mining protocol.\r\n\r\n### Message framing improvement\r\n\r\nThis update enhances the message framework by incorporating the security layer into the stratum framing itself, thus eliminating the need for redundant frame-length information and improving protocol efficiency. In the previous framework, individual frame lengths were revealed in the TCP traffic, creating potential vulnerabilities.\r\n\r\nThe new framework encrypts the Stratum V2 payload in byte chunks of maximum 65519 bytes and v2 header in 22 bytes forming AEAD ciphertexts, effectively concealing and protecting the frame length field and facilitating implementation of large-message encoding. This change **streamlines the parsing process**, making the TCP-transcript fully uniform and random looking.\r\n\r\n### Renaming Job Negotiator to Job Declarator\r\n\r\nIn response to community feedback regarding a protocol formerly known as **\"Job Negotiator\"**, we are announcing a naming update to clarify its purpose and functionality.\r\n\r\nThis protocol is one of the most critical features of Stratum V2. In combination with a template provider, it allows miners or an independent third party to select transactions, decentralizing bitcoin pool infrastructure.\r\n\r\nOver time, we've observed confusion surrounding the term \"negotiation,\" as it may imply a back-and-forth process between miners and pools to determine block content. We want to stress that this is not the case. Instead, the miner declares transactions to the pool, which can then choose to accept or decline them. There is no ongoing communication concerning block content between parties.\r\n\r\nIn cases where a pool accepts the declared transactions, they are subsequently propagated to the bitcoin network. Conversely, if a pool declines the transactions (censors), the miner will automatically seek an alternative pool. If the secondary pool also declines to include the transactions, the miner will continue to fall back, eventually resorting to solo mining.\r\n\r\nProvided that all miners run standardized software this could mean that the **entire hashrate** of pools that is censoring would end up with their competitors, or eventually solo mine.\r\n\r\nWith this in mind, we’re **renaming the Job Netogiation to Job Declaration protocol**.\r\n\r\n## 👷‍♂️ Stratum V2 implementations\r\n\r\nThus far, there have been two adoption paths for the Stratum V2 protocol:\r\n\r\n- Stratum V2 implementation by Braiins\r\n- SRI (Stratum V2 Reference implementation)\r\n\r\nBoth implementers, Braiins, and SRI, are part of the SV2 working group and share the goal of fostering a collaborative environment to support and encourage the broader adoption of Stratum V2. The remaining of the article will focus on the reference implementation, SRI, exploring its current status and future direction.\r\n\r\n### 🛣️ Stratum Reference Implementation Roadmap\r\n\r\nIn October 2022, we launched our SRI’s [first update](https://twitter.com/StratumV2/status/1579805619351326722?s=20), which allowed miners to run Stratum V1 firmware and connect to an SV2 compatible pool. Few months afterwards, [a new update](https://twitter.com/StratumV2/status/1646542195233640454?s=20) allowed miners to select transactions, democratizing block selection.\r\n\r\nCurrently we’re working on our **third major update**, below is an overview on what to expect in the future.\r\n\r\n![SRI Roadmap](/assets/SRI-roadmap-2023.png)\r\n\r\nThe third update represents our **“Now”** column on our roadmap, and aims to be completed in the next few months. It builds on all previous updates with more features, enhanced security performance and better flexibility. Most importantly the new update, should set the milestone for easier Stratum V2 integrations into existing pools. Miners and mining pools are encouraged to test out our [previous update](https://stratumprotocol.org/blog/stratumv2-jn-announcement/) and provide feedback in the meanwhile.\r\n\r\n**Our always evolving roadmap is available on [Miro](https://miro.com/app/board/uXjVM8FOwSE=/?share_link_id=902364718672), and also on [GitHub](https://github.com/orgs/stratum-mining/projects/5) for anyone to review and provide feedback. If you’re interested in joining our contributors team, hop on to [Discord](https://discord.gg/fsEW23wFYs).**\r\n\r\n### Message Generator - interoperability suite\r\n\r\nAs the Stratum V2 protocol gains popularity, we anticipate the emergence of various adoption paths. However, it is imperative that these implementations adhere closely to the specified standards. Deviation from the protocol specifications could yield catastrophic consequences, potentially resulting in significant profit loss.\r\n\r\nBecause of this, we developed an interoperability suite called **Message Generator** (or MG), which is essential in ensuring that all implementations are following the specs, and are able to test against each other. The tool allows anyone developing Stratum V2 based software to run a series of predefined tests in different configurations to ensure compatibility.\r\n\r\nMG is stateful, meaning it can save a value of an SV2 message received by the tested software to be sent later in another message. The logic of the stateful MG makes it easier to implement arbitrary actions on MG, allowing the MG to send SV2 messages where the fields' values are randomly chosen by the software, rather than the user. This represents a form of property-based testing. Currently, the implementation of arbitrary for MG is still a work in progress.\r\n\r\nThe following are the next steps for MG:\r\n\r\n- Implement arbitrary functionality\r\n- Write additional MG tests\r\n- Extend MG support to SV1 messages\r\n\r\n### 👩‍💻SRI Stack\r\n\r\nThus far, SRI’s architecture bundled some of the roles together. We’ve realized that having not overly specialized roles would ensure less bug-prone codebase, and also allow us to easier debug issues.\r\n\r\nWe’re now working on refactoring those roles, that would allow us to have:\r\n\r\n- **SV2 pool** that doesn’t have built in job-declaration\r\n- **SV2 mining-proxy** that does downstream aggregation/load balancing.\r\n- **Translator-proxy** that does SV1 to SV2 translation\r\n- **Job-declarator-client** that does job declaration\r\n- **Job-declarator-server** that accepts or declines jobs and does block propagation\r\n\r\n#### Stratum V2 Pool\r\n\r\nThe ability for **existing pools** to easily **integrate SV2** is our highest priority. This requires that we develop an HTTP API. Certain mining pools aim to monitor their clients' mining devices in order to display a malfunctioning device, or generally showcase additional data on their web app. This can be easily achieved by tracking the shares submitted by each device. We’re working on adding this in the form of an extension to the SRI, as a **monitoring-extension**.\r\n\r\n**Pool fallback**, described in the Job Declaration section above, would allow miners to easily fall-back to an alternative pool or solo mine if alternative pool(s) decline declared transactions is critical in ensuring decentralization of the protocol.\r\n\r\nAdding **pool’s signature** after extranonce, generating a **coinbase** with any, not just p2pkh script as pool's output are also on our roadmap.\r\n\r\n**Anyone** being able to **run and deploy a pool** is high on our priority list and would help with decentralization of power even more. That’s why our next focus will be to ensure our open-source stack can achieve that. We plan to develop a highly-customizable web UI for the pool.\r\n\r\n**Separating** the job-declarator from the pool into a job-declarator server allowing greater flexibility when deploying a Job declarator.\r\n\r\n#### Job Declarator\r\n\r\nWe’ve mentioned Job Declarator, as one of the most important aspects of SRI through this blog post. For greater flexibility, we’re refactoring the code and are working towards a **standalone Job Declarator** which would consist of JD-Server (Pool) and JD-Client (miner). Here’s what’s on our roadmap:\r\n\r\n- Refactoring the code that has already been started to separate various components (mining, pool, and Job Declarator)\r\n- Implementation of a Job Declarator Server in the pool\r\n- Implementation of cryptographic signature by the JD server in the token that identifies the custom job\r\n- Completion of the remaining messages so that the pool can propagate the block, enabling two parallel block propagations. The found block could be propagated by both miner’s and pool's bitcoin node.\r\n\r\n#### Template provider\r\n\r\nThe template-provider generates block templates and passes them to the pool or the job-declarator using the Template Distribution protocol. Template provider is most commonly a bitcoin core full node, but can be any other node implementation.\r\n\r\nWe’ve [submitted a PR](https://github.com/bitcoin/bitcoin/pull/27854) to add template provider to bitcoin core. The goal of opening a PR in this stage was to get concept acknowledgment from core developers and community. Thus far we’re received valuable feedback and are working towards implementing suggested changes. Unlike the [previous PR](https://github.com/bitcoin/bitcoin/pull/23049) which used rust-library, the new PR implements server and message serialization and deserialization in C++.\r\n\r\nNext, we’ll be adding **noise handshake encryption**, and **framing** improvement as per recent specs changes. Same changes need to be added to the SRI codebase.\r\n\r\nWe would like to thank everyone who has reviewed the PR thus far, and would like to invite more developers to take a look at it and provide feedback.\r\n\r\nAfter those updates are added, we will be **converting PR from draft to ready to review**. Hopefully after enough reviews and community consensus, the PR gets merged into the bitcoin core codebase. Meanwhile, miners wanting to help test and use the SV2 template provider can use our patched version.\r\n\r\n#### Proxies\r\n\r\nAll miners use proxies to aggregate connections and save on bandwidth. In SRI we have two types of proxies:\r\n\r\n- Translation Proxy\r\n- SV2 Proxy\r\n\r\n**Translation proxy** is something we worked on and deployed in October 2022. It allows miners running sv1 firmware to connect to an SV2 pool, by converting messages from SV1 to SV2 and vice versa. This means that miners don’t have to update firmware to use Stratum V2. Translation proxy has been tested and stabilized.\r\n\r\nOne of our goals in the future is to develop a **pure SV2 proxy**, that would aggregate connections from mining devices running SV2 firmware. Further improving mining-proxy means that we would be adding **web-ui** for easier management of devices by the miners at some point in the future.\r\n\r\n#### Benchmarking\r\n\r\nIt’s not an unknown fact that miners by nature are very rational actors in the ecosystem. With that in mind, their actions are usually profit-driven. To ensure Stratum V2 adoption, we’ve started developing a testing & benchmarking suite which would allow industry to easily compare Stratum V2 performance against Stratum V1 in different mining scenarios. Such tool should provide data that will help miners evaluate profitability and performance and make an informed decision. We will be documenting benchmarking results in the form of a report/case-study and sharing it with the industry.\r\n\r\nThe benchmarking suite will include:\r\n\r\n- Dockerized roles for both Stratum V1 and Stratum V2;\r\n- Possibility to benchmark protocols in regtest, testnet and possibly mainnet;\r\n- Possibility to easily benchmark different configurations permitted by SRI stack;\r\n- Web UI to easily interact with the benchmarking suite;\r\n- Dockerized metrics collector and visualizer such as Prometheus, Criterion, Grafana, etc.\r\n\r\n#### Firmware\r\n\r\nIn the future, as our contributors base grows, we’re hoping to kick-start the [firmware-bindings](https://docs.google.com/document/d/1iW48-Y4Xvr2IN7PU_9xYw-i5wReCQ98SyliI55_LSos/edit) as part of our efforts to support downstream firmware applications.\r\n\r\n#### Contributors\r\n\r\nAs you may have noticed, Stratum V2 and SRI will aim to have a lot of new features, improvements and big plans. We could never develop software without our community who has been actively helping us by testing the software and providing feedback. Thank you for your efforts.\r\n\r\nWe’re a small team of contributors with big dreams, to make that happen, **we need more people to join us in our mission** of decentralizing and improving bitcoin mining and we’re welcoming anyone interested in contributing to join us on [Discord](https://discord.gg/fsEW23wFYs).\r\n",
    "html": "<p>Today, we’re sharing the (Stratum Reference Implementation) <strong>roadmap</strong> providing insights into our ongoing work and the project’s direction. Additionally, we are publishing the latest progress on Stratum V2 protocol <strong>specifications</strong>, further emphasizing our commitment to openness and building in public.</p>\n<p>We believe fostering collaboration and transparency in the development process accelerates community involvement and brings us one step closer to our mission - better, more robust, and more decentralized bitcoin mining.</p>\n<p>At its core, SRI is a community-driven, open-source project. Our roadmap reflects the consensus reached within the community, constantly evolving with the collective input of every one of us.</p>\n<p>We welcome you to join us in our mission, start contributing, testing and help us shape the future of bitcoin mining.</p>\n<h2>📖 Stratum V2 specification</h2>\n<p>The specification is the heart of any protocol. The Stratum V2 specification, meticulously maintained by an independent open-source working group <a href=\"https://www.cnbc.com/2022/10/11/bitcoin-mining-software-overhaul-stratum-v2-promoted-by-block-braiins.html\">formed</a> in October 2022, is pivotal in defining the functionality. Since its inception, the specs have undergone several updates to enhance security, performance, flexibility, and simplicity.</p>\n<p>The main goal is to <strong>stabilize</strong> the specification, <strong>formalize</strong> the proposal procedures, and make them <strong>accessible</strong> to anyone interested in improving the Stratum V2.</p>\n<p>The table below summarizes the changelog of notable specs updates.</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">Notable update</th>\n<th style=\"text-align:left\">Link to a pull request</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Noise handshake improvement</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/stratum-mining/sv2-spec/pull/2\">#2</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Using Bitcoin core cryptographic primitives</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/stratum-mining/sv2-spec/pull/10\">#10</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Replace future_job with min_ntime</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/stratum-mining/sv2-spec/pull/12/\">#12</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Message framework improvement</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/stratum-mining/sv2-spec/pull/40\">#40</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Rename Job Negotiator to Job Declarator</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/stratum-mining/sv2-spec/pull/43\">#43</a></td>\n</tr>\n</tbody>\n</table>\n<h3>Noise handshake improvement</h3>\n<p>One of our first updates is improving the noise handshake. The Stratum V2 protocol updates refine the authenticated key agreement through a three-step process, <strong>enhancing security and communication efficiency</strong>. This includes, an exchange of keys, followed by an Elliptic Curve Diffie-Hellman (ECDH) operation, encryption algorithm negotiation and server authentication through a signature noise message.</p>\n<h3>Using Bitcoin Core cryptographic primitives</h3>\n<p>The PR #10 implemented Bitcoin Core’s cryptographic primitives, shifting from curve25519 to secp256k1 and from Blake2s to SHA256 for hashing. It introduces Schnorr/secp256k1 for server authentication, necessitating updates to CA-authority public keys and supports handshake with two different AEAD algorithms. The update <strong>simplifies handshake messages</strong> by eliminating unnecessary length prefixes and thoroughly describes each handshake step, moving the noise-secure layer description into a separate file.</p>\n<h3>Replace future_job with min_ntime</h3>\n<p>Previously, ‘future_job’ indicated whether a job related to a future or the last sent ‘SetNewPrevHash’ message on the channel. Now, ‘min_ntime’ serves this function, remaining empty for future jobs and filled with ‘min_ntime’ for immediate jobs linked to the last sent ‘SetNewPrevHash’. This change offers a more <strong>granular control over job allocation</strong> and initiation in the mining protocol.</p>\n<h3>Message framing improvement</h3>\n<p>This update enhances the message framework by incorporating the security layer into the stratum framing itself, thus eliminating the need for redundant frame-length information and improving protocol efficiency. In the previous framework, individual frame lengths were revealed in the TCP traffic, creating potential vulnerabilities.</p>\n<p>The new framework encrypts the Stratum V2 payload in byte chunks of maximum 65519 bytes and v2 header in 22 bytes forming AEAD ciphertexts, effectively concealing and protecting the frame length field and facilitating implementation of large-message encoding. This change <strong>streamlines the parsing process</strong>, making the TCP-transcript fully uniform and random looking.</p>\n<h3>Renaming Job Negotiator to Job Declarator</h3>\n<p>In response to community feedback regarding a protocol formerly known as <strong>“Job Negotiator”</strong>, we are announcing a naming update to clarify its purpose and functionality.</p>\n<p>This protocol is one of the most critical features of Stratum V2. In combination with a template provider, it allows miners or an independent third party to select transactions, decentralizing bitcoin pool infrastructure.</p>\n<p>Over time, we’ve observed confusion surrounding the term “negotiation,” as it may imply a back-and-forth process between miners and pools to determine block content. We want to stress that this is not the case. Instead, the miner declares transactions to the pool, which can then choose to accept or decline them. There is no ongoing communication concerning block content between parties.</p>\n<p>In cases where a pool accepts the declared transactions, they are subsequently propagated to the bitcoin network. Conversely, if a pool declines the transactions (censors), the miner will automatically seek an alternative pool. If the secondary pool also declines to include the transactions, the miner will continue to fall back, eventually resorting to solo mining.</p>\n<p>Provided that all miners run standardized software this could mean that the <strong>entire hashrate</strong> of pools that is censoring would end up with their competitors, or eventually solo mine.</p>\n<p>With this in mind, we’re <strong>renaming the Job Netogiation to Job Declaration protocol</strong>.</p>\n<h2>👷‍♂️ Stratum V2 implementations</h2>\n<p>Thus far, there have been two adoption paths for the Stratum V2 protocol:</p>\n<ul>\n<li>Stratum V2 implementation by Braiins</li>\n<li>SRI (Stratum V2 Reference implementation)</li>\n</ul>\n<p>Both implementers, Braiins, and SRI, are part of the SV2 working group and share the goal of fostering a collaborative environment to support and encourage the broader adoption of Stratum V2. The remaining of the article will focus on the reference implementation, SRI, exploring its current status and future direction.</p>\n<h3>🛣️ Stratum Reference Implementation Roadmap</h3>\n<p>In October 2022, we launched our SRI’s <a href=\"https://twitter.com/StratumV2/status/1579805619351326722?s=20\">first update</a>, which allowed miners to run Stratum V1 firmware and connect to an SV2 compatible pool. Few months afterwards, <a href=\"https://twitter.com/StratumV2/status/1646542195233640454?s=20\">a new update</a> allowed miners to select transactions, democratizing block selection.</p>\n<p>Currently we’re working on our <strong>third major update</strong>, below is an overview on what to expect in the future.</p>\n<p><img src=\"/assets/SRI-roadmap-2023.png\" alt=\"SRI Roadmap\"></p>\n<p>The third update represents our <strong>“Now”</strong> column on our roadmap, and aims to be completed in the next few months. It builds on all previous updates with more features, enhanced security performance and better flexibility. Most importantly the new update, should set the milestone for easier Stratum V2 integrations into existing pools. Miners and mining pools are encouraged to test out our <a href=\"https://stratumprotocol.org/blog/stratumv2-jn-announcement/\">previous update</a> and provide feedback in the meanwhile.</p>\n<p><strong>Our always evolving roadmap is available on <a href=\"https://miro.com/app/board/uXjVM8FOwSE=/?share_link_id=902364718672\">Miro</a>, and also on <a href=\"https://github.com/orgs/stratum-mining/projects/5\">GitHub</a> for anyone to review and provide feedback. If you’re interested in joining our contributors team, hop on to <a href=\"https://discord.gg/fsEW23wFYs\">Discord</a>.</strong></p>\n<h3>Message Generator - interoperability suite</h3>\n<p>As the Stratum V2 protocol gains popularity, we anticipate the emergence of various adoption paths. However, it is imperative that these implementations adhere closely to the specified standards. Deviation from the protocol specifications could yield catastrophic consequences, potentially resulting in significant profit loss.</p>\n<p>Because of this, we developed an interoperability suite called <strong>Message Generator</strong> (or MG), which is essential in ensuring that all implementations are following the specs, and are able to test against each other. The tool allows anyone developing Stratum V2 based software to run a series of predefined tests in different configurations to ensure compatibility.</p>\n<p>MG is stateful, meaning it can save a value of an SV2 message received by the tested software to be sent later in another message. The logic of the stateful MG makes it easier to implement arbitrary actions on MG, allowing the MG to send SV2 messages where the fields’ values are randomly chosen by the software, rather than the user. This represents a form of property-based testing. Currently, the implementation of arbitrary for MG is still a work in progress.</p>\n<p>The following are the next steps for MG:</p>\n<ul>\n<li>Implement arbitrary functionality</li>\n<li>Write additional MG tests</li>\n<li>Extend MG support to SV1 messages</li>\n</ul>\n<h3>👩‍💻SRI Stack</h3>\n<p>Thus far, SRI’s architecture bundled some of the roles together. We’ve realized that having not overly specialized roles would ensure less bug-prone codebase, and also allow us to easier debug issues.</p>\n<p>We’re now working on refactoring those roles, that would allow us to have:</p>\n<ul>\n<li><strong>SV2 pool</strong> that doesn’t have built in job-declaration</li>\n<li><strong>SV2 mining-proxy</strong> that does downstream aggregation/load balancing.</li>\n<li><strong>Translator-proxy</strong> that does SV1 to SV2 translation</li>\n<li><strong>Job-declarator-client</strong> that does job declaration</li>\n<li><strong>Job-declarator-server</strong> that accepts or declines jobs and does block propagation</li>\n</ul>\n<h4>Stratum V2 Pool</h4>\n<p>The ability for <strong>existing pools</strong> to easily <strong>integrate SV2</strong> is our highest priority. This requires that we develop an HTTP API. Certain mining pools aim to monitor their clients’ mining devices in order to display a malfunctioning device, or generally showcase additional data on their web app. This can be easily achieved by tracking the shares submitted by each device. We’re working on adding this in the form of an extension to the SRI, as a <strong>monitoring-extension</strong>.</p>\n<p><strong>Pool fallback</strong>, described in the Job Declaration section above, would allow miners to easily fall-back to an alternative pool or solo mine if alternative pool(s) decline declared transactions is critical in ensuring decentralization of the protocol.</p>\n<p>Adding <strong>pool’s signature</strong> after extranonce, generating a <strong>coinbase</strong> with any, not just p2pkh script as pool’s output are also on our roadmap.</p>\n<p><strong>Anyone</strong> being able to <strong>run and deploy a pool</strong> is high on our priority list and would help with decentralization of power even more. That’s why our next focus will be to ensure our open-source stack can achieve that. We plan to develop a highly-customizable web UI for the pool.</p>\n<p><strong>Separating</strong> the job-declarator from the pool into a job-declarator server allowing greater flexibility when deploying a Job declarator.</p>\n<h4>Job Declarator</h4>\n<p>We’ve mentioned Job Declarator, as one of the most important aspects of SRI through this blog post. For greater flexibility, we’re refactoring the code and are working towards a <strong>standalone Job Declarator</strong> which would consist of JD-Server (Pool) and JD-Client (miner). Here’s what’s on our roadmap:</p>\n<ul>\n<li>Refactoring the code that has already been started to separate various components (mining, pool, and Job Declarator)</li>\n<li>Implementation of a Job Declarator Server in the pool</li>\n<li>Implementation of cryptographic signature by the JD server in the token that identifies the custom job</li>\n<li>Completion of the remaining messages so that the pool can propagate the block, enabling two parallel block propagations. The found block could be propagated by both miner’s and pool’s bitcoin node.</li>\n</ul>\n<h4>Template provider</h4>\n<p>The template-provider generates block templates and passes them to the pool or the job-declarator using the Template Distribution protocol. Template provider is most commonly a bitcoin core full node, but can be any other node implementation.</p>\n<p>We’ve <a href=\"https://github.com/bitcoin/bitcoin/pull/27854\">submitted a PR</a> to add template provider to bitcoin core. The goal of opening a PR in this stage was to get concept acknowledgment from core developers and community. Thus far we’re received valuable feedback and are working towards implementing suggested changes. Unlike the <a href=\"https://github.com/bitcoin/bitcoin/pull/23049\">previous PR</a> which used rust-library, the new PR implements server and message serialization and deserialization in C++.</p>\n<p>Next, we’ll be adding <strong>noise handshake encryption</strong>, and <strong>framing</strong> improvement as per recent specs changes. Same changes need to be added to the SRI codebase.</p>\n<p>We would like to thank everyone who has reviewed the PR thus far, and would like to invite more developers to take a look at it and provide feedback.</p>\n<p>After those updates are added, we will be <strong>converting PR from draft to ready to review</strong>. Hopefully after enough reviews and community consensus, the PR gets merged into the bitcoin core codebase. Meanwhile, miners wanting to help test and use the SV2 template provider can use our patched version.</p>\n<h4>Proxies</h4>\n<p>All miners use proxies to aggregate connections and save on bandwidth. In SRI we have two types of proxies:</p>\n<ul>\n<li>Translation Proxy</li>\n<li>SV2 Proxy</li>\n</ul>\n<p><strong>Translation proxy</strong> is something we worked on and deployed in October 2022. It allows miners running sv1 firmware to connect to an SV2 pool, by converting messages from SV1 to SV2 and vice versa. This means that miners don’t have to update firmware to use Stratum V2. Translation proxy has been tested and stabilized.</p>\n<p>One of our goals in the future is to develop a <strong>pure SV2 proxy</strong>, that would aggregate connections from mining devices running SV2 firmware. Further improving mining-proxy means that we would be adding <strong>web-ui</strong> for easier management of devices by the miners at some point in the future.</p>\n<h4>Benchmarking</h4>\n<p>It’s not an unknown fact that miners by nature are very rational actors in the ecosystem. With that in mind, their actions are usually profit-driven. To ensure Stratum V2 adoption, we’ve started developing a testing &amp; benchmarking suite which would allow industry to easily compare Stratum V2 performance against Stratum V1 in different mining scenarios. Such tool should provide data that will help miners evaluate profitability and performance and make an informed decision. We will be documenting benchmarking results in the form of a report/case-study and sharing it with the industry.</p>\n<p>The benchmarking suite will include:</p>\n<ul>\n<li>Dockerized roles for both Stratum V1 and Stratum V2;</li>\n<li>Possibility to benchmark protocols in regtest, testnet and possibly mainnet;</li>\n<li>Possibility to easily benchmark different configurations permitted by SRI stack;</li>\n<li>Web UI to easily interact with the benchmarking suite;</li>\n<li>Dockerized metrics collector and visualizer such as Prometheus, Criterion, Grafana, etc.</li>\n</ul>\n<h4>Firmware</h4>\n<p>In the future, as our contributors base grows, we’re hoping to kick-start the <a href=\"https://docs.google.com/document/d/1iW48-Y4Xvr2IN7PU_9xYw-i5wReCQ98SyliI55_LSos/edit\">firmware-bindings</a> as part of our efforts to support downstream firmware applications.</p>\n<h4>Contributors</h4>\n<p>As you may have noticed, Stratum V2 and SRI will aim to have a lot of new features, improvements and big plans. We could never develop software without our community who has been actively helping us by testing the software and providing feedback. Thank you for your efforts.</p>\n<p>We’re a small team of contributors with big dreams, to make that happen, <strong>we need more people to join us in our mission</strong> of decentralizing and improving bitcoin mining and we’re welcoming anyone interested in contributing to join us on <a href=\"https://discord.gg/fsEW23wFYs\">Discord</a>.</p>\n"
  },
  {
    "slug": "stratumv2-jn-announcement",
    "title": " New SRI update with Job Negotiator - allowing miners to select transactions ",
    "description": "A new update of Stratum V2 is available.The new update allows miners to select transactions via a new sub-protocol and their node. We’re inviting miners, pools, firmware makers, and the community to check out our getting started guide and pilot test the software!",
    "date": "2023-04-14",
    "formattedDate": "Apr 14, 2023",
    "authors": [
      "Pavlenex"
    ],
    "tags": [
      "StratumV2",
      "JobNegotiator"
    ],
    "content": "\r\n_We dig dig dig dig dig dig dig in our mine\r\nThe whole day through\r\nTo dig dig dig dig dig dig dig is what we really like to do\r\nIt ain't no trick to get rich quick\r\nIf you dig dig dig with a shovel or a pick\r\nIn a mine! In a mine! In a mine! In a mine!\r\nWhere a million sats shine!_\r\n\r\n_Heigh-ho, Heigh-ho\r\nHeigh-ho, Heigh-ho_\r\n\r\n---\r\n\r\nAfter months of coding in our dusty mines, we’re ready to ship a new Stratum V2 reference implementation (SRI) update!\r\n\r\nThe new update allows miners to select transactions via a new sub-protocol and their node. This is a major milestone in democratizing transaction selections in pooled mining and decentralizing bitcoin!\r\n\r\n**We’re inviting miners, pools, firmware makers, and the community to check out our [getting started guide](https://stratumprotocol.org/getting-started/#config-d-sv1-firmware--translation-proxy-jn-job-negotiator--sv2-pool) and pilot test the software locally, with CPU or actual mining devices. Your feedback will have a high impact on the development direction.**\r\n\r\n**Please submit your feedback after testing [via this form](https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/).**\r\n\r\nSRI’s flexible stack offers various components when setting up a configuration that suits your needs. As an early adopter, we recommend testing the mining device with Stratum V1 firmware, connecting to an SV2 pool via Translation Proxy. Miners will run their own template provider (bitcoind) with the max fee policy. Within the translation proxy sits a Job Negotiator that runs a sub-protocol responsible for distributing miner’s templates to the pool.\r\n\r\n![Config D](/assets/config-d.svg)\r\n\r\nWhile there are various configurations to explore, testing the configuration, which includes Translation Proxy and Job Negotiator will provide valuable feedback to the development team.\r\n\r\n## What is a Job Negotiator?\r\n\r\nWith the current mining protocol - Stratum V1, the pools use their template providers to dispatch work to the miners. As a result, mining pools are the central point of failure and potential weak spot when it comes to censoring certain transactions by excluding them from the template.\r\n\r\nA Job Negotiator, in combination with a template provider, gives the responsibility back to miners or an independent third party to provide a new template (select transactions), thereby making bitcoin pool infrastructure more decentralized.\r\n\r\n### How does Job Negotiation work?\r\n\r\nBelow is a high-level overview of how a **Job Negotiator (JN)** works.\r\n\r\nWe call it the JN dance. 💃 Let’s dance!\r\n\r\n1. Downstream (Mining farm, miners) runs a JN. On startup, downstream’s JN connects to a JN run by the Pool\r\n2. Downstream’s JN sends the AllocateMiningJobToken message to Pool’s JN requesting to get a unique identifier for mining jobs\r\n3. Pool JN sends back a unique token that helps identify miner's job via the AllocateMiningJobToken.Sucess message. The pool also sends coinbase output used for payouts. Miners must build jobs that have a coinbase with that output.\r\n4. Downstream’s JN then connects to a Template Provider. Template Provider is usually run locally by the downstream or by an independent third-party\r\n5. In SV2, miners run their own nodes. The template provider is bitcoind node in our case. Upon established connection, the Template Provider sends New Template and SetNewPrevHash to downstream’s JN. New template contains the merkle path of the transactions that were selected by the bitcoind. SetNewPrevHash is the last valid block header in the blockchain\r\n6. With SetNewPrevHash, a new template, and the token. a new job can be constructed, so downstream’s JN sends a CommitMiningJob message containing a proposed set of transactions (template data) to Pool’s JN.\r\n7. The next step is critical in understanding how we implemented JN in the reference implementation. It differs from the specs. In the current iteration, the pool always answers with a CommitMiningJob.Success message accepting the miner's proposal. The pool must accept what’s been suggested by the miner(s). The pool must accept what the miner(s) suggest. Currently, the pool cannot decline what miners are proposing and needs to be made aware of the blocks being mined.\r\n8. In our next release, we’re adding the ability for miners to fall back to a different pool or solo mine if the pool fails to accept transactions selected by downstream’s Template Provider. We will also add sanity checks so pools can verify the validity of blocks.\r\n9. Next, the Translation proxy sends a SetCustomMiningJob message to the Pool. The pool sends the job_id that the proxy needs to add to the share and sends it back to the pool to prove that work has been done. Upon verifying the pool replies with SetCustomMiningJobSucess.\r\n10. Translation Proxy then translates the SV2 message and sends the mining.notify (sv1 message) to mining devices. Mining devices would then start mining and send mining.submit to the Pool through the Translation Proxy, submitting the shares to the pool.\r\n\r\nThis is our engineer's way of dancing, a bunch of bullet points. Below is an actual dance with some music. Volume up.\r\n\r\n[![How Job Negotiator works](https://img.youtube.com/vi/nOIAhRVCThs/mqdefault.jpg)](https://www.youtube.com/watch?v=nOIAhRVCThs)\r\n\r\n## How to get started?\r\n\r\nTo get started, follow the instructions on [this page](https://stratumprotocol.org/getting-started/#config-d-sv1-firmware--translation-proxy-jn-job-negotiator--sv2-pool). You can set up everything locally, use a CPU or an ASIC miner, connect to ours, or deploy a pool on your own.\r\n\r\nSo far, our community has tested on the following devices/firmware. If you’ve tested the SRI stack on a different device or a firmware version, please [fill this form out](https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/), and we will update the table.\r\n\r\n| Mining Device   | Firmware version        | Tested by                                    |\r\n| --------------- | ----------------------- | -------------------------------------------- |\r\n| S9              | Bitmain stock 5/25/2022 | Foundry, Galaxy Mining, 21 Hub Belgrade, Fi3 |\r\n| S9              | BraiinsOS               | Foundry                                      |\r\n| S19 Pro - A     | Bitmain stock 5/25/2022 | Galaxy Mining,                               |\r\n| WhatsMiner M30S | VE10                    | Foundry                                      |\r\n\r\n## What’s next?\r\n\r\nWith the next update, we will add a fallback functionality that would allow miners to fall back to a different pool or solo mine in case the pool chooses not to accept their suggestion. Miners would, in that case, disconnect and fall back.\r\n\r\nIn addition, we will add ways for pools to spot-check the validity of blocks and a few other improvements, like enhancing the encryption and ensuring we're following the latest changes in the spec. Most importantly, we hope to open a pull request for template provider in Bitcoin Core.\r\n\r\nWe'd like to thank Stratum V2 supporters, implementers, and all contributors, without whom SRI wouldn't be possible. Please donate to our [crowdfunding page](https://opensats.org/projects/stratumv2) hosted by OpenSats Foundation and Swan to support our development efforts.\r\n\r\n![Supporters](/assets/stratum-v2-supporters.png)\r\n\r\nIf you’re a company willing to directly support the work of developers by providing a direct grant and being featured on our website, please [get in touch](mailto:stratumv2@gmail.com). We will connect you with our contributors in need of funding.\r\n\r\n[Join our Discord](https://discord.gg/UHckbC7x58) to engage with the Stratum V2 community.\r\n\r\nWe’re excited to [hear your feedback](https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/prefill).\r\n\r\nHeigh-ho, Heigh-ho!\r\n",
    "html": "<p><em>We dig dig dig dig dig dig dig in our mine\nThe whole day through\nTo dig dig dig dig dig dig dig is what we really like to do\nIt ain’t no trick to get rich quick\nIf you dig dig dig with a shovel or a pick\nIn a mine! In a mine! In a mine! In a mine!\nWhere a million sats shine!</em></p>\n<p><em>Heigh-ho, Heigh-ho\nHeigh-ho, Heigh-ho</em></p>\n<hr>\n<p>After months of coding in our dusty mines, we’re ready to ship a new Stratum V2 reference implementation (SRI) update!</p>\n<p>The new update allows miners to select transactions via a new sub-protocol and their node. This is a major milestone in democratizing transaction selections in pooled mining and decentralizing bitcoin!</p>\n<p><strong>We’re inviting miners, pools, firmware makers, and the community to check out our <a href=\"https://stratumprotocol.org/getting-started/#config-d-sv1-firmware--translation-proxy-jn-job-negotiator--sv2-pool\">getting started guide</a> and pilot test the software locally, with CPU or actual mining devices. Your feedback will have a high impact on the development direction.</strong></p>\n<p><strong>Please submit your feedback after testing <a href=\"https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/\">via this form</a>.</strong></p>\n<p>SRI’s flexible stack offers various components when setting up a configuration that suits your needs. As an early adopter, we recommend testing the mining device with Stratum V1 firmware, connecting to an SV2 pool via Translation Proxy. Miners will run their own template provider (bitcoind) with the max fee policy. Within the translation proxy sits a Job Negotiator that runs a sub-protocol responsible for distributing miner’s templates to the pool.</p>\n<p><img src=\"/assets/config-d.svg\" alt=\"Config D\"></p>\n<p>While there are various configurations to explore, testing the configuration, which includes Translation Proxy and Job Negotiator will provide valuable feedback to the development team.</p>\n<h2>What is a Job Negotiator?</h2>\n<p>With the current mining protocol - Stratum V1, the pools use their template providers to dispatch work to the miners. As a result, mining pools are the central point of failure and potential weak spot when it comes to censoring certain transactions by excluding them from the template.</p>\n<p>A Job Negotiator, in combination with a template provider, gives the responsibility back to miners or an independent third party to provide a new template (select transactions), thereby making bitcoin pool infrastructure more decentralized.</p>\n<h3>How does Job Negotiation work?</h3>\n<p>Below is a high-level overview of how a <strong>Job Negotiator (JN)</strong> works.</p>\n<p>We call it the JN dance. 💃 Let’s dance!</p>\n<ol>\n<li>Downstream (Mining farm, miners) runs a JN. On startup, downstream’s JN connects to a JN run by the Pool</li>\n<li>Downstream’s JN sends the AllocateMiningJobToken message to Pool’s JN requesting to get a unique identifier for mining jobs</li>\n<li>Pool JN sends back a unique token that helps identify miner’s job via the AllocateMiningJobToken.Sucess message. The pool also sends coinbase output used for payouts. Miners must build jobs that have a coinbase with that output.</li>\n<li>Downstream’s JN then connects to a Template Provider. Template Provider is usually run locally by the downstream or by an independent third-party</li>\n<li>In SV2, miners run their own nodes. The template provider is bitcoind node in our case. Upon established connection, the Template Provider sends New Template and SetNewPrevHash to downstream’s JN. New template contains the merkle path of the transactions that were selected by the bitcoind. SetNewPrevHash is the last valid block header in the blockchain</li>\n<li>With SetNewPrevHash, a new template, and the token. a new job can be constructed, so downstream’s JN sends a CommitMiningJob message containing a proposed set of transactions (template data) to Pool’s JN.</li>\n<li>The next step is critical in understanding how we implemented JN in the reference implementation. It differs from the specs. In the current iteration, the pool always answers with a CommitMiningJob.Success message accepting the miner’s proposal. The pool must accept what’s been suggested by the miner(s). The pool must accept what the miner(s) suggest. Currently, the pool cannot decline what miners are proposing and needs to be made aware of the blocks being mined.</li>\n<li>In our next release, we’re adding the ability for miners to fall back to a different pool or solo mine if the pool fails to accept transactions selected by downstream’s Template Provider. We will also add sanity checks so pools can verify the validity of blocks.</li>\n<li>Next, the Translation proxy sends a SetCustomMiningJob message to the Pool. The pool sends the job_id that the proxy needs to add to the share and sends it back to the pool to prove that work has been done. Upon verifying the pool replies with SetCustomMiningJobSucess.</li>\n<li>Translation Proxy then translates the SV2 message and sends the mining.notify (sv1 message) to mining devices. Mining devices would then start mining and send mining.submit to the Pool through the Translation Proxy, submitting the shares to the pool.</li>\n</ol>\n<p>This is our engineer’s way of dancing, a bunch of bullet points. Below is an actual dance with some music. Volume up.</p>\n<p><a href=\"https://www.youtube.com/watch?v=nOIAhRVCThs\"><img src=\"https://img.youtube.com/vi/nOIAhRVCThs/mqdefault.jpg\" alt=\"How Job Negotiator works\"></a></p>\n<h2>How to get started?</h2>\n<p>To get started, follow the instructions on <a href=\"https://stratumprotocol.org/getting-started/#config-d-sv1-firmware--translation-proxy-jn-job-negotiator--sv2-pool\">this page</a>. You can set up everything locally, use a CPU or an ASIC miner, connect to ours, or deploy a pool on your own.</p>\n<p>So far, our community has tested on the following devices/firmware. If you’ve tested the SRI stack on a different device or a firmware version, please <a href=\"https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/\">fill this form out</a>, and we will update the table.</p>\n<table>\n<thead>\n<tr>\n<th>Mining Device</th>\n<th>Firmware version</th>\n<th>Tested by</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>S9</td>\n<td>Bitmain stock 5/25/2022</td>\n<td>Foundry, Galaxy Mining, 21 Hub Belgrade, Fi3</td>\n</tr>\n<tr>\n<td>S9</td>\n<td>BraiinsOS</td>\n<td>Foundry</td>\n</tr>\n<tr>\n<td>S19 Pro - A</td>\n<td>Bitmain stock 5/25/2022</td>\n<td>Galaxy Mining,</td>\n</tr>\n<tr>\n<td>WhatsMiner M30S</td>\n<td>VE10</td>\n<td>Foundry</td>\n</tr>\n</tbody>\n</table>\n<h2>What’s next?</h2>\n<p>With the next update, we will add a fallback functionality that would allow miners to fall back to a different pool or solo mine in case the pool chooses not to accept their suggestion. Miners would, in that case, disconnect and fall back.</p>\n<p>In addition, we will add ways for pools to spot-check the validity of blocks and a few other improvements, like enhancing the encryption and ensuring we’re following the latest changes in the spec. Most importantly, we hope to open a pull request for template provider in Bitcoin Core.</p>\n<p>We’d like to thank Stratum V2 supporters, implementers, and all contributors, without whom SRI wouldn’t be possible. Please donate to our <a href=\"https://opensats.org/projects/stratumv2\">crowdfunding page</a> hosted by OpenSats Foundation and Swan to support our development efforts.</p>\n<p><img src=\"/assets/stratum-v2-supporters.png\" alt=\"Supporters\"></p>\n<p>If you’re a company willing to directly support the work of developers by providing a direct grant and being featured on our website, please <a href=\"mailto:stratumv2@gmail.com\">get in touch</a>. We will connect you with our contributors in need of funding.</p>\n<p><a href=\"https://discord.gg/UHckbC7x58\">Join our Discord</a> to engage with the Stratum V2 community.</p>\n<p>We’re excited to <a href=\"https://docs.google.com/forms/d/1is27h37PtsXtXC9zSbweNfxcyEtHzATjdJphIy8hArw/prefill\">hear your feedback</a>.</p>\n<p>Heigh-ho, Heigh-ho!</p>\n"
  }
]